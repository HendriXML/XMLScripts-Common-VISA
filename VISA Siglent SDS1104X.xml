<?xml version="1.0" encoding="utf-8" standalone="no"?>
<pkg:Library
  xsi:schemaLocation="urn:schemas-www-wisware.nl-scriptingpackages ../XmlSchemas.Common.XmlScript/XMLScripting.Packages.xsd"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="urn:schemas-www-wisware.nl-xmlscripting"
  xmlns:pkg="urn:schemas-www-wisware.nl-scriptingpackages"
  xmlns:sys="urn:schemas-www-wisware.nl-xmlscripting"
  xmlns:ado="urn:schemas-www-wisware.nl-xmlscripting-ado"
  xmlns:fil="urn:schemas-www-wisware.nl-xmlscripting-filemanagement"
  xmlns:fwl="urn:schemas-www-wisware.nl-xmlscripting-windowsfirewall"
  xmlns:inx="urn:schemas-www-wisware.nl-xmlscripting-index"
  xmlns:lil="urn:schemas-www-wisware.nl-xmlscripting-linkedlist"
  xmlns:msx="urn:schemas-www-wisware.nl-xmlscripting-xml"
  xmlns:reg="urn:schemas-www-wisware.nl-xmlscripting-registry"
  xmlns:rep="urn:schemas-www-wisware.nl-xmlscripting-report"
  xmlns:sts="urn:schemas-www-wisware.nl-xmlscripting-showstatus"
  xmlns:syu="urn:schemas-www-wisware.nl-xmlscripting-sysutils"
  xmlns:stm="urn:schemas-www-wisware.nl-xmlscripting-statemanagement">
  <Uses>
    <Use Identifier="ElectronicUtils"/>
    <Use Identifier="VISAInstrument"/>
  </Uses>

  <Type>
    <Enumeration Identifier="TImageType" Elements="BMP, PNG"/>

    <Enumeration Identifier="THeaderType" Elements="Off, Short, Long"/>

    <Enumeration Identifier="TTraceType" Elements="CH1, CH2, CH3, CH4, Math, D0, D1, D2, D3, D4, D5, D6, D7, D8, D9, D10, D11, D12, D13, D14, D15" LowAlias="Low" HighAlias="High"/>

    <Enumeration Identifier="THWTraceType" Elements="CH1, CH2, CH3, CH4, TA, TB, TC, TD" LowAlias="Low" HighAlias="High"/>

    <Enumeration Identifier="TChannelType" Elements="CH1, CH2, CH3, CH4" LowAlias="Low" HighAlias="High"/>

    <Enumeration Identifier="TTriggerMode" Elements="Auto, Normal, Single, Stop" LowAlias="Low" HighAlias="High"/>

    <Enumeration Identifier="TMemSize" Elements="ms7K, ms14K, ms70K, ms140K, ms700K, ms1M4, ms7M, ms14M" LowAlias="Low" HighAlias="High"/>

    <Enumeration Identifier="TAvgTime" Elements="avg4, avg16, avg32, avg64, avg128, avg256, avg512, avg1024" LowAlias="Low" HighAlias="High"/>

    <Enumeration Identifier="TAcquireWay" Elements="Normal, PeakDetect, Average, HighRes" LowAlias="Low" HighAlias="High"/>

    <Enumeration Identifier="TStatusFlags" Elements="SignalAcquired = 1 shl 0, TriggerIsReady = 1 shl 13"/>

    <Enumeration Identifier="TWaveFormFormat" Elements="Dat2, All"/>

    <DataClass Identifier="TSiglentSDS1104X" Inherit="TVISAInstrument" ClassOfIdentifier="TTSiglentSDS1104X">
      <Field Identifier="_SignalAcquiredStatusCnt" Type="UInt64"/>
      <Field Identifier="_TriggerIsReadyStatusCnt" Type="UInt64"/>
    </DataClass>

    <DataClass Identifier="TSiglentSDS1104XIniHelper" Inherit="TIniHelper" DefaultConstructor="none">
    </DataClass>

    <DataClass Identifier="TAcquisitionOptions">
      <Field Identifier="LimitSamples" Type="UInt32"/>
    </DataClass>

    <DataClass Identifier="TMultiFrameAcquisitionOptions" Inherit="TAcquisitionOptions">
    </DataClass>

    <DataClass Identifier="TSingleSummedSampleAcquisitionOptions" Inherit="TAcquisitionOptions">
    </DataClass>
  </Type>

  <Constants>
    <Constant Identifier="AwgFixedSamples" Type="Int32" Expression="16384"/>
    <Constant Identifier="AwgMinValue" Type="Int32" Expression="-32768"/>
    <Constant Identifier="AwgMaxValue" Type="Int32" Expression="32767"/>
    <Constant Identifier="AwgMValueRange" Type="Int32" Expression="AwgMaxValue-AwgMinValue"/>

    <Constant Identifier="ckTDiv" Type="TConvertorKind" Expression="TConvertorKind.NanoSecond"/>

    <Constant Identifier="sErrorGettingAWGWaveData" Type="string" Expression="'Error getting AWG WaveData'"/>
    <Constant Identifier="sErrorGettingScreenCapture" Type="string" Expression="'Error getting ScreenCapture'"/>
    <Constant Identifier="sErrorGettingWaveData" Type="string" Expression="'Error getting WaveData'"/>
    <Constant Identifier="sErrorReadingHeader" Type="string" Expression="'Error reading header'"/>
    <Constant Identifier="sErrorReadingWaveLength" Type="string" Expression="'Error reading WaveLength'"/>
    <Constant Identifier="sErrorReadingWaveData" Type="string" Expression="'Error reading wave data'"/>
    <Constant Identifier="sErrorHeaderParsing" Type="string" Expression="'Parsing error header'"/>
    <Constant Identifier="sErrorHeaderParsingInvalidTrace" Type="string" Expression="'Parsing error header - invalid trace'"/>
    <Constant Identifier="sErrorInvalidTraceData" Type="string" Expression="'Invalid trace data: %d'"/>
    <Constant Identifier="sErrorUnexpectedHeader" Type="string" Expression="'Unexpected header'"/>
    <Constant Identifier="sErrorUnexpectedAcquireWay" Type="string" Expression="'Unexpected AcquireWay'"/>
    <Constant Identifier="sErrorUnsupportedHeader" Type="string" Expression="'Unsupported header'"/>
    <Constant Identifier="sErrorUnsupportedAcquireWay" Type="string" Expression="'Unsupported AcquireWay'"/>
    <Constant Identifier="sErrorInvalidChannel" Type="string" Expression="'Invalid channel'"/>
    <Constant Identifier="sErrorInvalidChannelType" Type="string" Expression="'Invalid channel'"/>
    <Constant Identifier="sErrorInvalidTriggerMode" Type="string" Expression="'Invalid trigger mode'"/>
    <Constant Identifier="sErrorInvalidTraceType" Type="string" Expression="'Invalid trace'"/>
    <Constant Identifier="sErrorInvalidHWTraceType" Type="string" Expression="'Invalid hardware trace'"/>
    <Constant Identifier="sErrorInvalidAvgTime" Type="string" Expression="'Invalid AvgTime'"/>
    <Constant Identifier="sErrorInvalidMemSize" Type="string" Expression="'Invalid MemSize'"/>
    <Constant Identifier="sErrorInvalidAcquireWay" Type="string" Expression="'Invalid acquire way'"/>
    <Constant Identifier="sErrorUnsupportedMemSize" Type="string" Expression="'Unsupported MemSize'"/>
    <Constant Identifier="sErrorWaveFormFormat" Type="string" Expression="'Unsupported WaveFormFormat'"/>
    <Constant Identifier="sErrorTraceWithoutChannel" Type="string" Expression="'Trace doesn''t have a channel'"/>
    <Constant Identifier="sErrorChannelWithoutTrace" Type="string" Expression="'Channel doesn''t have a trace'"/>
    <Constant Identifier="sInvalidInitialWaveformat" Type="string" Expression="'Invalid initial Waveformat'"/>
    <Constant Identifier="sErrorUnsupportedAcquisitionType" Type="string" Expression="'Unsupported acquisition type'"/>
    <Constant Identifier="sErrorUnsupportedBandWidthAnswer" Type="string" Expression="'Unsupported bandwidth answer: '"/>

    <Constant Identifier="c0" Type="AnsiChar" Expression="'0'"/>
    <Constant Identifier="cVDivisions" Type="UInt32" Expression="8"/>
    <Constant Identifier="cVScreenSteps" Type="UInt32" Expression="200"/>
    <Constant Identifier="cVStepsPerDivision" Type="UInt32" Expression="cVScreenSteps div cVDivisions"/>
    <Constant Identifier="cVGran" Type="Extended" Expression="1/cVStepsPerDivision"/>
    <Constant Identifier="ordC0" Type="UInt32" Expression="CharOrd(c0)"/>
    <Constant Identifier="cVMathGran" Type="Extended" Expression="1/50"/>
    <Constant Identifier="cHDivisions" Type="UInt32" Expression="14"/>
    <Constant Identifier="cHGran" Type="Extended" Expression="cHDivisions/2"/>
    <Constant Identifier="coDescriptionBlockSizeOffset" Type="UInt32" Expression="36"/>
    <Constant Identifier="coWaveSizeOffset" Type="UInt32" Expression="60"/>
    <Constant Identifier="coNumberOfPointsOffset" Type="UInt32" Expression="116"/>
    <Constant Identifier="coPointsPerScreen" Type="UInt32" Expression="120"/>
    <Constant Identifier="coFirstValidPntOffset" Type="UInt32" Expression="124"/>
    <Constant Identifier="coLastValidPntOffset" Type="UInt32" Expression="128"/>
    <Constant Identifier="coSegmentIndexOffset" Type="UInt32" Expression="140"/>
    <Constant Identifier="coVerticalGainOffset" Type="UInt32" Expression="156"/>
    <Constant Identifier="coVerticalOffsetOffset" Type="UInt32" Expression="160"/>
    <Constant Identifier="coNominalBitsOffset" Type="UInt32" Expression="172"/>
    <Constant Identifier="coHorizontalIntervalOffset" Type="UInt32" Expression="176"/>
    <Constant Identifier="coHorizontalOffsetOffset" Type="UInt32" Expression="180"/>
    <Constant Identifier="coPixelOffsetOffset" Type="UInt32" Expression="188"/>
    <Constant Identifier="coVUnitOffset" Type="UInt32" Expression="196"/>
    <Constant Identifier="coHorizontalUncertaintyOffset" Type="UInt32" Expression="292"/>
    <Constant Identifier="coTriggerTimeOffset" Type="UInt32" Expression="296"/>
    <Constant Identifier="coProbeAttenuationOffset" Type="UInt32" Expression="328"/>
    <Constant Identifier="cWaveCaptureTimeout" Type="UInt32" Expression="100000"/>
    <Constant Identifier="viSpace" Type="ViString" Expression="' '"/>
    <Constant Identifier="viParamSep" Type="ViString" Expression="','"/>
    <Constant Identifier="cCH1" Type="ViString" Expression="'C1'"/>
    <Constant Identifier="cCH2" Type="ViString" Expression="'C2'"/>
    <Constant Identifier="cCH3" Type="ViString" Expression="'C3'"/>
    <Constant Identifier="cCH4" Type="ViString" Expression="'C4'"/>
    <Constant Identifier="cNameChannelTypeCH1" Type="string" Expression="'CH1'"/>
    <Constant Identifier="cNameChannelTypeCH2" Type="string" Expression="'CH2'"/>
    <Constant Identifier="cNameChannelTypeCH3" Type="string" Expression="'CH3'"/>
    <Constant Identifier="cNameChannelTypeCH4" Type="string" Expression="'CH4'"/>
    <Constant Identifier="cNameTraceTypeCH1" Type="string" Expression="'CH1'"/>
    <Constant Identifier="cNameTraceTypeCH2" Type="string" Expression="'CH2'"/>
    <Constant Identifier="cNameTraceTypeCH3" Type="string" Expression="'CH3'"/>
    <Constant Identifier="cNameTraceTypeCH4" Type="string" Expression="'CH4'"/>
    <Constant Identifier="cNameTraceTypeMath" Type="string" Expression="'Math'"/>
    <Constant Identifier="cNameTraceTypeD0" Type="string" Expression="'D0'"/>
    <Constant Identifier="cNameTraceTypeD1" Type="string" Expression="'D1'"/>
    <Constant Identifier="cNameTraceTypeD2" Type="string" Expression="'D2'"/>
    <Constant Identifier="cNameTraceTypeD3" Type="string" Expression="'D3'"/>
    <Constant Identifier="cNameTraceTypeD4" Type="string" Expression="'D4'"/>
    <Constant Identifier="cNameTraceTypeD5" Type="string" Expression="'D5'"/>
    <Constant Identifier="cNameTraceTypeD6" Type="string" Expression="'D6'"/>
    <Constant Identifier="cNameTraceTypeD7" Type="string" Expression="'D7'"/>
    <Constant Identifier="cNameTraceTypeD8" Type="string" Expression="'D8'"/>
    <Constant Identifier="cNameTraceTypeD9" Type="string" Expression="'D9'"/>
    <Constant Identifier="cNameTraceTypeD10" Type="string" Expression="'D10'"/>
    <Constant Identifier="cNameTraceTypeD11" Type="string" Expression="'D11'"/>
    <Constant Identifier="cNameTraceTypeD12" Type="string" Expression="'D12'"/>
    <Constant Identifier="cNameTraceTypeD13" Type="string" Expression="'D13'"/>
    <Constant Identifier="cNameTraceTypeD14" Type="string" Expression="'D14'"/>
    <Constant Identifier="cNameTraceTypeD15" Type="string" Expression="'D15'"/>
    <Constant Identifier="cNameHWTraceTypeCH1" Type="string" Expression="'CH1'"/>
    <Constant Identifier="cNameHWTraceTypeCH2" Type="string" Expression="'CH2'"/>
    <Constant Identifier="cNameHWTraceTypeCH3" Type="string" Expression="'CH3'"/>
    <Constant Identifier="cNameHWTraceTypeCH4" Type="string" Expression="'CH4'"/>
    <Constant Identifier="cNameHWTraceTypeA" Type="string" Expression="'TA'"/>
    <Constant Identifier="cNameHWTraceTypeB" Type="string" Expression="'TB'"/>
    <Constant Identifier="cNameHWTraceTypeC" Type="string" Expression="'TC'"/>
    <Constant Identifier="cNameHWTraceTypeD" Type="string" Expression="'TD'"/>
    <Constant Identifier="cNameTriggerModeAuto" Type="string" Expression="'Auto'"/>
    <Constant Identifier="cNameTriggerModeNormal" Type="string" Expression="'Normal'"/>
    <Constant Identifier="cNameTriggerModeSingle" Type="string" Expression="'Single'"/>
    <Constant Identifier="cNameTriggerModeStop" Type="string" Expression="'Stop'"/>
    <Constant Identifier="cNameMemSize7K" Type="string" Expression="'7K'"/>
    <Constant Identifier="cNameMemSize14K" Type="string" Expression="'14K'"/>
    <Constant Identifier="cNameMemSize70K" Type="string" Expression="'70K'"/>
    <Constant Identifier="cNameMemSize140K" Type="string" Expression="'140K'"/>
    <Constant Identifier="cNameMemSize700K" Type="string" Expression="'700K'"/>
    <Constant Identifier="cNameMemSize1M4" Type="string" Expression="'1M4'"/>
    <Constant Identifier="cNameMemSize7M" Type="string" Expression="'7M'"/>
    <Constant Identifier="cNameMemSize14M" Type="string" Expression="'14M'"/>
    <Constant Identifier="cNameAvg4" Type="string" Expression="'4'"/>
    <Constant Identifier="cNameAvg16" Type="string" Expression="'16'"/>
    <Constant Identifier="cNameAvg32" Type="string" Expression="'32'"/>
    <Constant Identifier="cNameAvg64" Type="string" Expression="'64'"/>
    <Constant Identifier="cNameAvg128" Type="string" Expression="'128'"/>
    <Constant Identifier="cNameAvg256" Type="string" Expression="'256'"/>
    <Constant Identifier="cNameAvg512" Type="string" Expression="'512'"/>
    <Constant Identifier="cNameAvg1024" Type="string" Expression="'1024'"/>
    <Constant Identifier="cNameAcquireWayNormal" Type="string" Expression="'Normal'"/>
    <Constant Identifier="cNameAcquireWayPeakDetect" Type="string" Expression="'PeakDetect'"/>
    <Constant Identifier="cNameAcquireWayAverage" Type="string" Expression="'Average'"/>
    <Constant Identifier="cNameAcquireWayHighRes" Type="string" Expression="'HighRes'"/>

    <Constant Identifier="cTrigAuto" Type="ViString" Expression="'AUTO'"/>
    <Constant Identifier="cTrigNorm" Type="ViString" Expression="'NORM'"/>
    <Constant Identifier="cTrigSingle" Type="ViString" Expression="'SINGLE'"/>
    <Constant Identifier="cTrigStop" Type="ViString" Expression="'STOP'"/>
    <Constant Identifier="cTrigQuery" Type="ViString" Expression="'TRIG_MODE?'"/>
    <Constant Identifier="cTrigCommand" Type="ViString" Expression="'TRIG_MODE '"/>
    <Constant Identifier="cWaveBlobSize" Type="UInt32" Expression="29360640"/>
    <Constant Identifier="cScreenCapureBlobSize" Type="UInt32" Expression="1000000"/>
    <Constant Identifier="cTIME_DIVQuery" Type="ViString" Expression="'TIME_DIV?'"/>
    <Constant Identifier="cTIME_DIVCommand" Type="ViString" Expression="'TIME_DIV '"/>
    <Constant Identifier="cMATH_VERT_DIVQuery" Type="ViString" Expression="'MATH_VERT_DIV?'"/>
    <Constant Identifier="cMATH_VERT_DIVCommand" Type="ViString" Expression="'MATH_VERT_DIV '"/>
    <Constant Identifier="cMATH_VERT_POSQuery" Type="ViString" Expression="'MATH_VERT_POS?'"/>
    <Constant Identifier="cMATH_VERT_POSCommand" Type="ViString" Expression="'MATH_VERT_POS '"/>
    <Constant Identifier="cTRIG_DELAYQuery" Type="ViString" Expression="'TRIG_DELAY?'"/>
    <Constant Identifier="cTRIG_DELAYCommand" Type="ViString" Expression="'TRIG_DELAY '"/>
    <Constant Identifier="cVOLT_DIVQuery" Type="ViString" Expression="':VOLT_DIV?'"/>
    <Constant Identifier="cVOLT_DIVCommand" Type="ViString" Expression="':VOLT_DIV '"/>
    <Constant Identifier="cTRIG_LEVELQuery" Type="ViString" Expression="'TRIG_LEVEL?'"/>
    <Constant Identifier="cTRIG_LEVELCommand" Type="ViString" Expression="'TRIG_LEVEL '"/>
    <Constant Identifier="cVOFFSETQuery" Type="ViString" Expression="':OFFSET?'"/>
    <Constant Identifier="cVOFFSETCommand" Type="ViString" Expression="':OFFSET '"/>
    <Constant Identifier="cATTENUATIONQuery" Type="ViString" Expression="':ATTENUATION?'"/>
    <Constant Identifier="cATTENUATIONCommand" Type="ViString" Expression="':ATTENUATION '"/>
    <Constant Identifier="cSARAQuery" Type="ViString" Expression="'SARA?'"/>
    <Constant Identifier="cTRIG_SELECTQuery" Type="ViString" Expression="'TRIG_SELECT?'"/>
    <Constant Identifier="cTRIG_SELECTCommand" Type="ViString" Expression="'TRIG_SELECT '"/>
    <Constant Identifier="cChannelTRIG_LEVELCommand" Type="ViString" Expression="':TRIG_LEVEL '"/>
    <Constant Identifier="cTRIG_PATTERNQuery" Type="ViString" Expression="'TRIG_PATTERN?'"/>
    <Constant Identifier="cTRIG_PATTERNCommand" Type="ViString" Expression="'TRIG_PATTERN '"/>
    <Constant Identifier="cSTOPCommand" Type="ViString" Expression="'STOP'"/>
    <Constant Identifier="cWAITCommand" Type="ViString" Expression="'WAIT'"/>
    <Constant Identifier="cWAITCommandSpace" Type="ViString" Expression="'WAIT '"/>
    <Constant Identifier="cARMCommand" Type="ViString" Expression="'ARM'"/>
    <Constant Identifier="cINRQuery" Type="ViString" Expression="'INR?'"/>
    <Constant Identifier="cACQUIRE_WAYCommand" Type="ViString" Expression="'ACQUIRE_WAY AVERAGE,'"/>
    <Constant Identifier="cSCDPCommand" Type="ViString" Expression="'SCDP'"/>
    <Constant Identifier="cTRAQuery" Type="ViString" Expression="':TRA?'"/>
    <Constant Identifier="cTRACommand" Type="ViString" Expression="':TRA'"/>
    <Constant Identifier="cHISTORY_MODEQuery" Type="ViString" Expression="'HISTORY_MODE?'"/>
    <Constant Identifier="cHISTORY_MODECommand" Type="ViString" Expression="'HISTORY_MODE'"/>
    <Constant Identifier="cMEMORY_SIZEQuery" Type="ViString" Expression="'MEMORY_SIZE?'"/>
    <Constant Identifier="cMEMORY_SIZECommand" Type="ViString" Expression="'MEMORY_SIZE '"/>
    <Constant Identifier="cWFSUTYPE1Command" Type="ViString" Expression="'WFSU TYPE,1'"/>
    <Constant Identifier="cWFSUCommand" Type="ViString" Expression="'WFSU SP,%d,NP,%d,FP,%d,SN,%d'"/>
    <Constant Identifier="cBANDWIDTH_LIMITQuery" Type="ViString" Expression="'BANDWIDTH_LIMIT?'"/>
    <Constant Identifier="cBANDWIDTH_LIMITCommand" Type="ViString" Expression="'BANDWIDTH_LIMIT '"/>
  </Constants>

  <Variables>
    <Variable Identifier="ucTDiv" Type="TUnitConvertor" Init="TUnitConvertor.Create(TGranularity.Pico, TSiUnit.Second)"/>
    <Variable Identifier="ucTriggerDelay" Type="TUnitConvertor" Init="ucTDiv"/>

    <Variable Identifier="ucVDiv" Type="TUnitConvertor" Init="TUnitConvertor.Create(TGranularity.Pico, TSiUnit.Volt)"/>
    <Variable Identifier="ucMathVDiv" Type="TUnitConvertor" Init="ucVDiv"/>
    <Variable Identifier="ucMathVPosition" Type="TUnitConvertor" Init="ucVDiv"/>
    <Variable Identifier="ucTriggerLevel" Type="TUnitConvertor" Init="ucVDiv"/>
    <Variable Identifier="ucVOffset" Type="TUnitConvertor" Init="ucVDiv"/>

    <Variable Identifier="ucAttenuation" Type="TUnitConvertor" Init="TUnitConvertor.Create(TGranularity.Micro, TSiUnit.None)"/>

    <Variable Identifier="TraceTypeNameIndex" Type="TMappingCaseInSensitiveUnicodeStringToInt64"   />
    <Variable Identifier="HWTraceTypeNameIndex" Type="TMappingCaseInSensitiveUnicodeStringToInt64" />
    <Variable Identifier="ChannelTypeNameIndex" Type="TMappingCaseInSensitiveUnicodeStringToInt64" />
    <Variable Identifier="TriggerModeNameIndex" Type="TMappingCaseInSensitiveUnicodeStringToInt64" />
    <Variable Identifier="MemSizeNameIndex" Type="TMappingCaseInSensitiveUnicodeStringToInt64"     />
    <Variable Identifier="AvgTimeNameIndex" Type="TMappingCaseInSensitiveUnicodeStringToInt64"     />
    <Variable Identifier="AcquireWayNameIndex" Type="TMappingCaseInSensitiveUnicodeStringToInt64"  />
  </Variables>

  <Procedures>

    <Function Identifier="TTSiglentSDS1104X.TraceChannel" Type="TChannelType" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Trace" Type="TTraceType"/>
      </Parameters>
      <Block>
        <Case Expression="Trace" Optimalisation="integermapping">
          <On Select="TTraceType.CH1">
            <Execute Statement="Result:= TChannelType.CH1"/>
          </On>
          <On Select="TTraceType.CH2">
            <Execute Statement="Result:= TChannelType.CH2"/>
          </On>
          <On Select="TTraceType.CH3">
            <Execute Statement="Result:= TChannelType.CH3"/>
          </On>
          <On Select="TTraceType.CH4">
            <Execute Statement="Result:= TChannelType.CH4"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorTraceWithoutChannel)"/>
          </Otherwise>
        </Case>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.ChannelTrace" Type="TTraceType" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Channel" Type="TChannelType"/>
      </Parameters>
      <Block>
        <Case Expression="Channel" Optimalisation="integermapping">
          <On Select="TChannelType.CH1">
            <Execute Statement="Result:= TTraceType.CH1"/>
          </On>
          <On Select="TChannelType.CH2">
            <Execute Statement="Result:= TTraceType.CH2"/>
          </On>
          <On Select="TChannelType.CH3">
            <Execute Statement="Result:= TTraceType.CH3"/>
          </On>
          <On Select="TChannelType.CH4">
            <Execute Statement="Result:= TTraceType.CH4"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorChannelWithoutTrace)"/>
          </Otherwise>
        </Case>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.ChannelTypeName" Type="string" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Value" Type="TChannelType"/>
      </Parameters>
      <Block>
        <Case Expression="Value" Optimalisation="integermapping">
          <On Select="TChannelType.CH1">
            <Execute Statement="Result:= cNameChannelTypeCH1"/>
          </On>
          <On Select="TChannelType.CH2">
            <Execute Statement="Result:= cNameChannelTypeCH2"/>
          </On>
          <On Select="TChannelType.CH3">
            <Execute Statement="Result:= cNameChannelTypeCH3"/>
          </On>
          <On Select="TChannelType.CH4">
            <Execute Statement="Result:= cNameChannelTypeCH4"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidChannel)"/>
          </Otherwise>
        </Case>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.TraceTypeName" Type="string" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Value" Type="TTraceType"/>
      </Parameters>
      <Block>
        <Case Expression="Value" Optimalisation="integermapping">
          <On Select="TTraceType.CH1">
            <Execute Statement="Result:= cNameTraceTypeCH1"/>
          </On>
          <On Select="TTraceType.CH2">
            <Execute Statement="Result:= cNameTraceTypeCH2"/>
          </On>
          <On Select="TTraceType.CH3">
            <Execute Statement="Result:= cNameTraceTypeCH3"/>
          </On>
          <On Select="TTraceType.CH4">
            <Execute Statement="Result:= cNameTraceTypeCH4"/>
          </On>
          <On Select="TTraceType.Math">
            <Execute Statement="Result:= cNameTraceTypeMath"/>
          </On>
          <On Select="TTraceType.D0">
            <Execute Statement="Result:= cNameTraceTypeD0"/>
          </On>
          <On Select="TTraceType.D1">
            <Execute Statement="Result:= cNameTraceTypeD1"/>
          </On>
          <On Select="TTraceType.D2">
            <Execute Statement="Result:= cNameTraceTypeD2"/>
          </On>
          <On Select="TTraceType.D3">
            <Execute Statement="Result:= cNameTraceTypeD3"/>
          </On>
          <On Select="TTraceType.D4">
            <Execute Statement="Result:= cNameTraceTypeD4"/>
          </On>
          <On Select="TTraceType.D5">
            <Execute Statement="Result:= cNameTraceTypeD5"/>
          </On>
          <On Select="TTraceType.D6">
            <Execute Statement="Result:= cNameTraceTypeD6"/>
          </On>
          <On Select="TTraceType.D7">
            <Execute Statement="Result:= cNameTraceTypeD7"/>
          </On>
          <On Select="TTraceType.D8">
            <Execute Statement="Result:= cNameTraceTypeD8"/>
          </On>
          <On Select="TTraceType.D9">
            <Execute Statement="Result:= cNameTraceTypeD9"/>
          </On>
          <On Select="TTraceType.D10">
            <Execute Statement="Result:= cNameTraceTypeD10"/>
          </On>
          <On Select="TTraceType.D11">
            <Execute Statement="Result:= cNameTraceTypeD11"/>
          </On>
          <On Select="TTraceType.D12">
            <Execute Statement="Result:= cNameTraceTypeD12"/>
          </On>
          <On Select="TTraceType.D13">
            <Execute Statement="Result:= cNameTraceTypeD13"/>
          </On>
          <On Select="TTraceType.D14">
            <Execute Statement="Result:= cNameTraceTypeD14"/>
          </On>
          <On Select="TTraceType.D15">
            <Execute Statement="Result:= cNameTraceTypeD15"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidTraceType)"/>
          </Otherwise>
        </Case>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.HWTraceTypeName" Type="string" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Value" Type="THWTraceType"/>
      </Parameters>
      <Block>
        <Case Expression="Value" Optimalisation="integermapping">
          <On Select="THWTraceType.CH1">
            <Execute Statement="Result:= cNameHWTraceTypeCH1"/>
          </On>
          <On Select="THWTraceType.CH2">
            <Execute Statement="Result:= cNameHWTraceTypeCH2"/>
          </On>
          <On Select="THWTraceType.CH3">
            <Execute Statement="Result:= cNameHWTraceTypeCH3"/>
          </On>
          <On Select="THWTraceType.CH4">
            <Execute Statement="Result:= cNameHWTraceTypeCH4"/>
          </On>
          <On Select="THWTraceType.TA">
            <Execute Statement="Result:= cNameHWTraceTypeA"/>
          </On>
          <On Select="THWTraceType.TB">
            <Execute Statement="Result:= cNameHWTraceTypeB"/>
          </On>
          <On Select="THWTraceType.TC">
            <Execute Statement="Result:= cNameHWTraceTypeC"/>
          </On>
          <On Select="THWTraceType.TD">
            <Execute Statement="Result:= cNameHWTraceTypeD"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidHWTraceType)"/>
          </Otherwise>
        </Case>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.TriggerModeName" Type="string" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Value" Type="TTriggerMode"/>
      </Parameters>
      <Block>
        <Case Expression="Value" Optimalisation="integermapping">
          <On Select="TTriggerMode.Auto">
            <Execute Statement="Result:= cNameTriggerModeAuto"/>
          </On>
          <On Select="TTriggerMode.Normal">
            <Execute Statement="Result:= cNameTriggerModeNormal"/>
          </On>
          <On Select="TTriggerMode.Single">
            <Execute Statement="Result:= cNameTriggerModeSingle"/>
          </On>
          <On Select="TTriggerMode.Stop">
            <Execute Statement="Result:= cNameTriggerModeStop"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidTriggerMode)"/>
          </Otherwise>
        </Case>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.MemSizeName" Type="string" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Value" Type="TMemSize"/>
      </Parameters>
      <Block>
        <Case Expression="Value" Optimalisation="integermapping">
          <On Select="TMemSize.ms7K">
            <Execute Statement="Result:= cNameMemSize7K"/>
          </On>
          <On Select="TMemSize.ms14K">
            <Execute Statement="Result:= cNameMemSize14K"/>
          </On>
          <On Select="TMemSize.ms70K">
            <Execute Statement="Result:= cNameMemSize70K"/>
          </On>
          <On Select="TMemSize.ms140K">
            <Execute Statement="Result:= cNameMemSize140K"/>
          </On>
          <On Select="TMemSize.ms700K">
            <Execute Statement="Result:= cNameMemSize700K"/>
          </On>
          <On Select="TMemSize.ms1M4">
            <Execute Statement="Result:= cNameMemSize1M4"/>
          </On>
          <On Select="TMemSize.ms7M">
            <Execute Statement="Result:= cNameMemSize7M"/>
          </On>
          <On Select="TMemSize.ms14M">
            <Execute Statement="Result:= cNameMemSize14M"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidMemSize)"/>
          </Otherwise>
        </Case>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.AvgTimeName" Type="string" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Value" Type="TAvgTime"/>
      </Parameters>
      <Block>
        <Case Expression="Value" Optimalisation="integermapping">
          <On Select="TAvgTime.avg4">
            <Execute Statement="Result:= cNameAvg4"/>
          </On>
          <On Select="TAvgTime.avg16">
            <Execute Statement="Result:= cNameAvg16"/>
          </On>
          <On Select="TAvgTime.avg32">
            <Execute Statement="Result:= cNameAvg32"/>
          </On>
          <On Select="TAvgTime.avg64">
            <Execute Statement="Result:= cNameAvg64"/>
          </On>
          <On Select="TAvgTime.avg128">
            <Execute Statement="Result:= cNameAvg128"/>
          </On>
          <On Select="TAvgTime.avg256">
            <Execute Statement="Result:= cNameAvg256"/>
          </On>
          <On Select="TAvgTime.avg512">
            <Execute Statement="Result:= cNameAvg512"/>
          </On>
          <On Select="TAvgTime.avg1024">
            <Execute Statement="Result:= cNameAvg1024"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidAvgTime)"/>
          </Otherwise>
        </Case>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.AcquireWayName" Type="string" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Value" Type="TAcquireWay"/>
      </Parameters>
      <Block>
        <Case Expression="Value" Optimalisation="integermapping">
          <On Select="TAcquireWay.Normal">
            <Execute Statement="Result:= cNameAcquireWayNormal"/>
          </On>
          <On Select="TAcquireWay.PeakDetect">
            <Execute Statement="Result:= cNameAcquireWayPeakDetect"/>
          </On>
          <On Select="TAcquireWay.Average">
            <Execute Statement="Result:= cNameAcquireWayAverage"/>
          </On>
          <On Select="TAcquireWay.HighRes">
            <Execute Statement="Result:= cNameAcquireWayHighRes"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidAvgTime)"/>
          </Otherwise>
        </Case>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.TraceTypeFromName" Type="TTraceType" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Name" Type="string"/>
      </Parameters>
      <Block>
        <Block Condition="IsEmpty(TraceTypeNameIndex)">
          <Execute Statement="TraceTypeNameIndex:= TMappingCaseInSensitiveUnicodeStringToInt64.Create"/>
          <ForLoop Indexer="I" From="TTraceType.Low" To="TTraceType.High">
            <inx:Index.MapValue Index="TraceTypeNameIndex" Key="TraceTypeName(I)" Value="I"/>
          </ForLoop>
        </Block>
        <Variable Identifier="Found" Type="Boolean"/>
        <inx:Index.FindValue Index="TraceTypeNameIndex" Key="Name" Value="Result" Found="Found" Flags="NoErrorOnNotFound" />
        <Raise Expression="Exception.Create(sErrorInvalidTraceType)" Condition="not Found"/>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.HWTraceTypeFromName" Type="THWTraceType" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Name" Type="string"/>
      </Parameters>
      <Block>
        <Block Condition="IsEmpty(HWTraceTypeNameIndex)">
          <ForLoop Indexer="I" From="THWTraceType.Low" To="THWTraceType.High">
            <inx:Index.MapValue Index="HWTraceTypeNameIndex" Key="HWTraceTypeName(I)" Value="I"/>
          </ForLoop>
          <Execute Statement="HWTraceTypeNameIndex:= TMappingCaseInSensitiveUnicodeStringToInt64.Create"/>
        </Block>
        <Variable Identifier="Found" Type="Boolean"/>
        <inx:Index.FindValue Index="HWTraceTypeNameIndex" Key="Name" Value="Result" Found="Found" Flags="NoErrorOnNotFound" />
        <Raise Expression="Exception.Create(sErrorInvalidHWTraceType)" Condition="not Found"/>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.ChannelTypeFromName" Type="TChannelType" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Name" Type="string"/>
      </Parameters>
      <Block>
        <Block Condition="IsEmpty(ChannelTypeNameIndex)">
          <Execute Statement="ChannelTypeNameIndex:= TMappingCaseInSensitiveUnicodeStringToInt64.Create"/>
          <ForLoop Indexer="I" From="TChannelType.Low" To="TChannelType.High">
            <inx:Index.MapValue Index="ChannelTypeNameIndex" Key="ChannelTypeName(I)" Value="I"/>
          </ForLoop>
        </Block>
        <Variable Identifier="Found" Type="Boolean"/>
        <inx:Index.FindValue Index="ChannelTypeNameIndex" Key="Name" Value="Result" Found="Found" Flags="NoErrorOnNotFound" />
        <Raise Expression="Exception.Create(sErrorInvalidChannelType)" Condition="not Found"/>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.TriggerModeFromName" Type="TTriggerMode" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Name" Type="string"/>
      </Parameters>
      <Block>
        <Block Condition="IsEmpty(TriggerModeNameIndex)">
          <ForLoop Indexer="I" From="TTriggerMode.Low" To="TTriggerMode.High">
            <inx:Index.MapValue Index="TriggerModeNameIndex" Key="TriggerModeName(I)" Value="I"/>
          </ForLoop>
          <Execute Statement="TriggerModeNameIndex:= TMappingCaseInSensitiveUnicodeStringToInt64.Create"/>
        </Block>
        <Variable Identifier="Found" Type="Boolean"/>
        <inx:Index.FindValue Index="TriggerModeNameIndex" Key="Name" Value="Result" Found="Found" Flags="NoErrorOnNotFound" />
        <Raise Expression="Exception.Create(sErrorInvalidTriggerMode)" Condition="not Found"/>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.MemSizeFromName" Type="TMemSize" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Name" Type="string"/>
      </Parameters>
      <Block>
        <Block Condition="IsEmpty(MemSizeNameIndex)">
          <Execute Statement="MemSizeNameIndex:= TMappingCaseInSensitiveUnicodeStringToInt64.Create"/>
          <ForLoop Indexer="I" From="TMemSize.Low" To="TMemSize.High">
            <inx:Index.MapValue Index="MemSizeNameIndex" Key="MemSizeName(I)" Value="I"/>
          </ForLoop>
        </Block>
        <Variable Identifier="Found" Type="Boolean"/>
        <inx:Index.FindValue Index="MemSizeNameIndex" Key="Name" Value="Result" Found="Found" Flags="NoErrorOnNotFound" />
        <Raise Expression="Exception.Create(sErrorInvalidMemSize)" Condition="not Found"/>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.AvgTimeFromName" Type="TAvgTime" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Name" Type="string"/>
      </Parameters>
      <Block>
        <Block Condition="IsEmpty(AvgTimeNameIndex)">
          <Execute Statement="AvgTimeNameIndex:= TMappingCaseInSensitiveUnicodeStringToInt64.Create"/>
          <ForLoop Indexer="I" From="TAvgTime.Low" To="TAvgTime.High">
            <inx:Index.MapValue Index="AvgTimeNameIndex" Key="AvgTimeName(I)" Value="I"/>
          </ForLoop>
        </Block>
        <Variable Identifier="Found" Type="Boolean"/>
        <inx:Index.FindValue Index="AvgTimeNameIndex" Key="Name" Value="Result" Found="Found" Flags="NoErrorOnNotFound" />
        <Raise Expression="Exception.Create(sErrorInvalidAvgTime)" Condition="not Found"/>
      </Block>
    </Function>

    <Function Identifier="TTSiglentSDS1104X.AcquireWayFromName" Type="TAcquireWay" IsDeterministic="true">
      <Parameters>
        <Parameter Identifier="Name" Type="string"/>
      </Parameters>
      <Block>
        <Block Condition="IsEmpty(AcquireWayNameIndex)">
          <Execute Statement="AcquireWayNameIndex:= TMappingCaseInSensitiveUnicodeStringToInt64.Create"/>
          <ForLoop Indexer="I" From="TAcquireWay.Low" To="TAcquireWay.High">
            <inx:Index.MapValue Index="AcquireWayNameIndex" Key="AcquireWayName(I)" Value="I"/>
          </ForLoop>
        </Block>
        <Variable Identifier="Found" Type="Boolean"/>
        <inx:Index.FindValue Index="AcquireWayNameIndex" Key="Name" Value="Result" Found="Found" Flags="NoErrorOnNotFound" />
        <Raise Expression="Exception.Create(sErrorInvalidAcquireWay)" Condition="not Found"/>
      </Block>
    </Function>

    <Property Identifier="TSiglentSDS1104X.CommHeader" Type="THeaderType">
      <Getter>
        <Variable Identifier="ValueS" Type="ViString" Init="QueryString('CHDR?')"/>
        <Choose>
          <When Expression="ValueS = 'OFF'">
            <Execute Statement="Result:= THeaderType.Off"/>
          </When>
          <When Expression="ValueS = 'CHDR SHORT'">
            <Execute Statement="Result:= THeaderType.Short"/>
          </When>
          <When Expression="ValueS = 'CHDR LONG'">
            <Execute Statement="Result:= THeaderType.Long"/>
          </When>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorUnexpectedHeader)"/>
          </Otherwise>
        </Choose>
      </Getter>
      <Setter>
        <Case Expression="Value">
          <On Select="THeaderType.Off">
            <Execute Statement="WriteString('CHDR OFF')"/>
          </On>
          <On Select="THeaderType.Short">
            <Execute Statement="WriteString('CHDR SHORT')"/>
          </On>
          <On Select="THeaderType.Long">
            <Execute Statement="WriteString('CHDR LONG')"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorUnsupportedHeader)"/>
          </Otherwise>
        </Case>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.AcquireWay" Type="TAcquireWay" >
      <Getter>
        <Variable Identifier="ValueS" Type="ViString" Init="QueryString('ACQUIRE_WAY?')"/>
        <Choose>
          <When Expression="ValueS = 'SAMPLING'">
            <Execute Statement="Result:= TAcquireWay.Normal"/>
          </When>
          <When Expression="ValueS = 'PEAK_DETECT'">
            <Execute Statement="Result:= TAcquireWay.PeakDetect"/>
          </When>
          <When Expression="ValueS = 'AVERAGE'">
            <Execute Statement="Result:= TAcquireWay.Average"/>
          </When>
          <When Expression="ValueS = 'HIGH_RES'">
            <Execute Statement="Result:= TAcquireWay.HighRes"/>
          </When>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorUnexpectedAcquireWay)"/>
          </Otherwise>
        </Choose>
      </Getter>
      <Setter>
        <Case Expression="Value">
          <On Select="TAcquireWay.Normal">
            <Execute Statement="WriteString('ACQUIRE_WAY SAMPLING')"/>
          </On>
          <On Select="TAcquireWay.PeakDetect">
            <Execute Statement="WriteString('ACQUIRE_WAY PEAK_DETECT')"/>
          </On>
          <On Select="TAcquireWay.Average">
            <Execute Statement="WriteString('ACQUIRE_WAY AVERAGE')"/>
          </On>
          <On Select="TAcquireWay.HighRes">
            <Execute Statement="WriteString('ACQUIRE_WAY HIGH_RES')"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorUnsupportedAcquireWay)"/>
          </Otherwise>
        </Case>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.ChannelID" Type="ViString">
      <Parameters>
        <Parameter Identifier="Channel" Type="TChannelType"/>
      </Parameters>
      <Getter>
        <Case Expression="Channel">
          <On Select="TChannelType.CH1">
            <Execute Statement="Result:= cCH1"/>
          </On>
          <On Select="TChannelType.CH2">
            <Execute Statement="Result:= cCH2"/>
          </On>
          <On Select="TChannelType.CH3">
            <Execute Statement="Result:= cCH3"/>
          </On>
          <On Select="TChannelType.CH4">
            <Execute Statement="Result:= cCH4"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidChannel)"/>
          </Otherwise>
        </Case>
      </Getter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.TraceID" Type="ViString" >
      <Parameters>
        <Parameter Identifier="Trace" Type="TTraceType"/>
      </Parameters>
      <Getter>
        <Case Expression="Trace">
          <On Select="TTraceType.CH1..TTraceType.CH4">
            <Execute Statement="Result:= ViFormat('C%d', Trace - TTraceType.CH1 + 1)"/>
          </On>
          <On Select="TTraceType.Math">
            <Execute Statement="Result:= 'MATH'"/>
          </On>
          <On Select="TTraceType.D0..TTraceType.D15">
            <Execute Statement="Result:= ViFormat('D%d', Trace - TTraceType.D0)"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidTraceType)"/>
          </Otherwise>
        </Case>
      </Getter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.TriggerName" Type="ViString" >
      <Parameters>
        <Parameter Identifier="TriggerMode" Type="TTriggerMode"/>
      </Parameters>
      <Getter>
        <Case Expression="TriggerMode" Optimalisation="integermapping">
          <On Select="TTriggerMode.Auto">
            <Execute Statement="Result:= cTrigAuto"/>
          </On>
          <On Select="TTriggerMode.Normal">
            <Execute Statement="Result:= cTrigNorm"/>
          </On>
          <On Select="TTriggerMode.Single">
            <Execute Statement="Result:= cTrigSingle"/>
          </On>
          <On Select="TTriggerMode.Stop">
            <Execute Statement="Result:= cTrigStop"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidTriggerMode)"/>
          </Otherwise>
        </Case>
      </Getter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.TriggerType" Type="TTriggerMode" >
      <Parameters>
        <Parameter Identifier="TriggerS" Type="ViString"/>
      </Parameters>
      <Getter>
        <Choose>
          <When Expression="TriggerS = cTrigAuto">
            <Execute Statement="Result:= TTriggerMode.Auto"/>
          </When>
          <When Expression="TriggerS = cTrigNorm">
            <Execute Statement="Result:= TTriggerMode.Normal"/>
          </When>
          <When Expression="TriggerS = cTrigSingle">
            <Execute Statement="Result:= TTriggerMode.Single"/>
          </When>
          <When Expression="TriggerS = cTrigStop">
            <Execute Statement="Result:= TTriggerMode.Stop"/>
          </When>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidTriggerMode)"/>
          </Otherwise>
        </Choose>
      </Getter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.HWTraceID" Type="ViString" >
      <Parameters>
        <Parameter Identifier="Trace" Type="THWTraceType"/>
      </Parameters>
      <Getter>
        <Case Expression="Trace" Optimalisation="integermapping">
          <On Select="THWTraceType.CH1..THWTraceType.CH4">
            <Execute Statement="Result:= ViFormat('C%d', Trace - THWTraceType.CH1 + 1)"/>
          </On>
          <On Select="THWTraceType.TA">
            <Execute Statement="Result:= 'TA'"/>
          </On>
          <On Select="THWTraceType.TB">
            <Execute Statement="Result:= 'TB'"/>
          </On>
          <On Select="THWTraceType.TC">
            <Execute Statement="Result:= 'TC'"/>
          </On>
          <On Select="THWTraceType.TD">
            <Execute Statement="Result:= 'TD'"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidHWTraceType)"/>
          </Otherwise>
        </Case>
      </Getter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.AvgTime" Type="ViString" >
      <Parameters>
        <Parameter Identifier="Time" Type="TAvgTime"/>
      </Parameters>
      <Getter>
        <Case Expression="Time" Optimalisation="integermapping">
          <On Select="TAvgTime.avg4">
            <Execute Statement="Result:= '4'"/>
          </On>
          <On Select="TAvgTime.avg16">
            <Execute Statement="Result:= '16'"/>
          </On>
          <On Select="TAvgTime.avg32">
            <Execute Statement="Result:= '32'"/>
          </On>
          <On Select="TAvgTime.avg64">
            <Execute Statement="Result:= '64'"/>
          </On>
          <On Select="TAvgTime.avg128">
            <Execute Statement="Result:= '128'"/>
          </On>
          <On Select="TAvgTime.avg256">
            <Execute Statement="Result:= '256'"/>
          </On>
          <On Select="TAvgTime.avg512">
            <Execute Statement="Result:= '512'"/>
          </On>
          <On Select="TAvgTime.avg1024">
            <Execute Statement="Result:= '1024'"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidAvgTime)"/>
          </Otherwise>
        </Case>
      </Getter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.MemorySize" Type="TMemSize" >
      <Getter>
        <Variable Identifier="ValueS" Type="ViString" Init="QueryString(cMEMORY_SIZEQuery)"/>
        <Choose>
          <When Expression="ValueS = '7K'">
            <Execute Statement="Result:= TMemSize.ms7K"/>
          </When>
          <When Expression="ValueS = '14K'">
            <Execute Statement="Result:= TMemSize.ms14K"/>
          </When>
          <When Expression="ValueS = '70K'">
            <Execute Statement="Result:= TMemSize.ms70K"/>
          </When>
          <When Expression="ValueS = '140K'">
            <Execute Statement="Result:= TMemSize.ms140K"/>
          </When>
          <When Expression="ValueS = '700K'">
            <Execute Statement="Result:= TMemSize.ms700K"/>
          </When>
          <When Expression="ValueS = '1.4M'">
            <Execute Statement="Result:= TMemSize.ms1M4"/>
          </When>
          <When Expression="ValueS = '7M'">
            <Execute Statement="Result:= TMemSize.ms7M"/>
          </When>
          <When Expression="ValueS = '14M'">
            <Execute Statement="Result:= TMemSize.ms14M"/>
          </When>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorInvalidMemSize)"/>
          </Otherwise>
        </Choose>
      </Getter>
      <Setter>
        <Variable Identifier="ValueS" Type="ViString"/>
        <Case Expression="Value" Optimalisation="integermapping">
          <On Select="TMemSize.ms7K">
            <Execute Statement="ValueS:= '7K'"/>
          </On>
          <On Select="TMemSize.ms14K">
            <Execute Statement="ValueS:= '14K'"/>
          </On>
          <On Select="TMemSize.ms70K">
            <Execute Statement="ValueS:= '70K'"/>
          </On>
          <On Select="TMemSize.ms140K">
            <Execute Statement="ValueS:= '140K'"/>
          </On>
          <On Select="TMemSize.ms1M4">
            <Execute Statement="ValueS:= '1.4M'"/>
          </On>
          <On Select="TMemSize.ms7M">
            <Execute Statement="ValueS:= '7M'"/>
          </On>
          <On Select="TMemSize.ms14M">
            <Execute Statement="ValueS:= '14M'"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorUnsupportedMemSize)"/>
          </Otherwise>
        </Case>
        <Execute Statement="WriteString(cMEMORY_SIZECommand + ValueS)"/>
      </Setter>
    </Property>

    <Procedure Identifier="TSiglentSDS1104X.SetTrigger">
      <Parameters>
        <Parameter Identifier="Channel" Type="TChannelType"/>
        <Parameter Identifier="Value" Type="Extended"/>
      </Parameters>
      <Block>
        <Execute Statement="WriteString(ChannelID[Channel] + cChannelTRIG_LEVELCommand + FloatToCode(Value))"/>
      </Block>
    </Procedure>

    <Property Identifier="TSiglentSDS1104X.TriggerSelect" Type="ViString">
      <Getter>
        <Execute Statement="Result:= QueryString(cTRIG_SELECTQuery)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cTRIG_SELECTCommand + Value)"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.TriggerPattern" Type="ViString">
      <Getter>
        <Execute Statement="Result:= QueryString(cTRIG_PATTERNQuery)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cTRIG_PATTERNCommand + Value)"/>
      </Setter>
    </Property>


    <Property Identifier="TSiglentSDS1104X.Enabled" Type="Boolean">
      <Parameters>
        <Parameter Identifier="HWTraceType" Type="THWTraceType"/>
      </Parameters>
      <Getter>
        <Execute Statement="WriteString(HWTraceID[HWTraceType] + cTRAQuery)"/>
        <Execute Statement="Result:= ReadOnOff"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteOnOff(HWTraceID[HWTraceType] + cTRACommand, Value)"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.BandwidthLimit" Type="Boolean">
      <Parameters>
        <Parameter Identifier="Channel" Type="TChannelType"/>
      </Parameters>
      <Getter>
        <Execute Statement="WriteString(cBANDWIDTH_LIMITQuery)"/>
        <Variable Identifier="RetValue" Type="viString" Init="ReadString"/>
        <Execute Statement="Result:= False"/>
        <Variable Identifier="CurrentChannel" Type="TChannelType"/>
        <Variable Identifier="ValidEndstate" Type="Boolean" Init="False"/>
        <!-- C1,ON,C2,OFF,C3,OFF,C4,OFF -->
        <stm:StateHandler InitialState="ChannelExpected">
          <StringLoop StringValue="RetValue" Ansi="1" OrdinalIdentifier="ChrI">
            <stm:HandleStates>
              <stm:State Name="ChannelExpected">
                <Case Expression="ChrI" OrdinalType="ansichar">
                  <On Select="' '"/>
                  <On Select="'C'">
                    <stm:SetState Name="InChannelParam"/>
                  </On>
                  <Otherwise>
                    <Raise Expression="Exception.Create(sErrorUnsupportedBandWidthAnswer)"/>
                  </Otherwise>
                </Case>
              </stm:State>
              <stm:State Name="InChannelParam">
                <Case Expression="ChrI" OrdinalType="ansichar">
                  <On Select="'1'">
                    <Execute Statement="CurrentChannel:= TChannelType.CH1"/>
                    <stm:SetState Name="AfterChannelParam"/>
                  </On>
                  <On Select="'2'">
                    <Execute Statement="CurrentChannel:= TChannelType.CH2"/>
                    <stm:SetState Name="AfterChannelParam"/>
                  </On>
                  <On Select="'3'">
                    <Execute Statement="CurrentChannel:= TChannelType.CH3"/>
                    <stm:SetState Name="AfterChannelParam"/>
                  </On>
                  <On Select="'4'">
                    <Execute Statement="CurrentChannel:= TChannelType.CH4"/>
                    <stm:SetState Name="AfterChannelParam"/>
                  </On>
                  <Otherwise>
                    <Break/>
                  </Otherwise>
                </Case>
              </stm:State>
              <stm:State Name="AfterChannelParam">
                <Case Expression="ChrI" OrdinalType="ansichar">
                  <On Select="' '">
                  </On>
                  <On Select="','">
                    <stm:SetState Name="AfterStateParamStart"/>
                  </On>
                  <Otherwise>
                    <Break/>
                  </Otherwise>
                </Case>
              </stm:State>
              <stm:State Name="AfterStateParamStart">
                <Case Expression="ChrI" OrdinalType="ansichar">
                  <On Select="' '">
                  </On>
                  <On Select="'o', 'O'">
                    <stm:SetState Name="AfterStateParamO"/>
                  </On>
                  <Otherwise>
                    <Break/>
                  </Otherwise>
                </Case>
              </stm:State>
              <stm:State Name="AfterStateParamO">
                <Case Expression="ChrI" OrdinalType="ansichar">
                  <On Select="'f', 'F'">
                    <stm:SetState Name="AfterStateParamF"/>
                  </On>
                  <On Select="'n', 'N'">
                    <stm:SetState Name="AfterStateDone"/>
                    <Execute Statement="Result:= True" Condition="CurrentChannel = Channel"/>
                    <Execute Statement="ValidEndstate:= True"/>
                  </On>
                  <Otherwise>
                    <Break/>
                  </Otherwise>
                </Case>
              </stm:State>
              <stm:State Name="AfterStateParamF">
                <Case Expression="ChrI" OrdinalType="ansichar">
                  <On Select="'f', 'F'">
                    <stm:SetState Name="AfterStateDone"/>
                    <Execute Statement="Result:= False" Condition="CurrentChannel = Channel"/>
                    <Execute Statement="ValidEndstate:= True"/>
                  </On>
                  <Otherwise>
                    <Break/>
                  </Otherwise>
                </Case>
              </stm:State>
              <stm:State Name="AfterStateDone">
                <Case Expression="ChrI" OrdinalType="ansichar">
                  <On Select="' '">
                  </On>
                  <On Select="','">
                    <stm:SetState Name="ChannelExpected"/>
                    <Execute Statement="ValidEndstate:= False"/>
                  </On>
                  <Otherwise>
                    <Break/>
                  </Otherwise>
                </Case>
              </stm:State>
            </stm:HandleStates>
          </StringLoop>
        </stm:StateHandler>
        <Raise Expression="Exception.Create(sErrorUnsupportedBandWidthAnswer + RetValue)" Condition="not ValidEndstate"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteOnOff(cBANDWIDTH_LIMITCommand + ChannelID[Channel] + viParamSep, Value)"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.HistoryMode" Type="Boolean">
      <Getter>
        <Execute Statement="WriteString(cHISTORY_MODEQuery)"/>
        <Execute Statement="Result:= ReadOnOff"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteOnOff(cHISTORY_MODECommand, Value)"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.SequenceMode" Type="Boolean">
      <Getter>
        <Execute Statement="WriteString('ACquire_SeQuence_Mode')"/>
        <Execute Statement="Result:= ReadOnOff"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteOnOff('ACquire_SeQuence_Mode', Value)"/>
      </Setter>
    </Property>


    <Property Identifier="TSiglentSDS1104X.ActiveFrame" Type="UInt32" >
      <Getter>
        <Execute Statement="WriteString('FRAME_SET?')"/>
        <Execute Statement="Result:= ReadInt64"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteInt64('FRAME_SET', Value)"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.SegmentCount" Type="UInt32" >
      <Getter>
        <Execute Statement="WriteString('ACquire_SeQuence_Seg?')"/>
        <Execute Statement="Result:= ReadInt64"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteInt64('ACquire_SeQuence_Seg', Value)"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.TriggerMode" Type="TTriggerMode" >
      <Getter>
        <Execute Statement="Result:= TriggerType[QueryString(cTrigQuery)]"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cTrigCommand + TriggerName[Value])"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.MathVDiv" Type="Extended" >
      <Getter>
        <Execute Statement="Result:= QueryFloat(cMATH_VERT_DIVQuery)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cMATH_VERT_DIVCommand + FloatToCode(Value))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.ConvMathVDiv" Type="ConvInt" >
      <Getter>
        <Execute Statement="Result:= QueryConvInt(cMATH_VERT_DIVQuery, ucMathVDiv)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cMATH_VERT_DIVCommand + ucMathVDiv.IntValueToEngineeringStr(Value, TUnitPostFix.None, viDecimalSeperatior))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.MathVPosition" Type="Extended" >
      <Getter>
        <Execute Statement="Result:= QueryFloat(cMATH_VERT_POSQuery)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cMATH_VERT_POSCommand + FloatToCode(Value))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.ConvMathVPosition" Type="ConvInt" >
      <Getter>
        <Execute Statement="Result:= QueryConvInt(cMATH_VERT_POSQuery, ucMathVPosition)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cMATH_VERT_POSCommand + ucMathVPosition.IntValueToEngineeringStr(Value, TUnitPostFix.None, viDecimalSeperatior))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.TriggerDelay" Type="Extended" >
      <Getter>
        <Execute Statement="Result:= QueryFloat(cTRIG_DELAYQuery)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cTRIG_DELAYCommand + FloatToCode(Value))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.ConvTriggerDelay" Type="ConvInt" >
      <Getter>
        <Execute Statement="Result:= QueryConvInt(cTRIG_DELAYQuery, ucTriggerDelay)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cTRIG_DELAYCommand + ucTriggerDelay.IntValueToEngineeringStr(Value, TUnitPostFix.None, viDecimalSeperatior))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.TriggerLevel" Type="Extended" >
      <Getter>
        <Execute Statement="Result:= QueryFloat(cTRIG_LEVELQuery)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cTRIG_LEVELCommand + FloatToCode(Value))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.ConvTriggerLevel" Type="ConvInt" >
      <Getter>
        <Execute Statement="Result:= QueryConvInt(cTRIG_LEVELQuery, ucTriggerLevel)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cTRIG_LEVELCommand + ucTriggerLevel.IntValueToEngineeringStr(Value, TUnitPostFix.None, viDecimalSeperatior))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.TDiv" Type="Extended" >
      <Getter>
        <Variable Identifier="ValueS" Type="ViString" Init="QueryString(cTIME_DIVQuery)"/>
        <Execute Statement="Result:= CodeToFloat(ValueS)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cTIME_DIVCommand + FloatToCode(Value))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.ConvTDiv" Type="ConvInt" >
      <Getter>
        <Execute Statement="Result:= QueryConvInt(cTIME_DIVQuery, ucTDiv)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(cTIME_DIVCommand + ucTDiv.IntValueToEngineeringStr(Value, TUnitPostFix.None, viDecimalSeperatior))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.VDiv" Type="Extended" >
      <Parameters>
        <Parameter Identifier="Channel" Type="TChannelType"/>
      </Parameters>
      <Getter>
        <Execute Statement="Result:= QueryFloat(ChannelID[Channel] + cVOLT_DIVQuery)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(ChannelID[Channel] + cVOLT_DIVCommand + FloatToCode(Value))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.ConvVDiv" Type="ConvInt" >
      <Parameters>
        <Parameter Identifier="Channel" Type="TChannelType"/>
      </Parameters>
      <Getter>
        <Execute Statement="Result:= QueryConvInt(ChannelID[Channel] + cVOLT_DIVQuery, ucVDiv)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(ChannelID[Channel] + cVOLT_DIVCommand + ucVDiv.IntValueToEngineeringStr(Value, TUnitPostFix.None, viDecimalSeperatior))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.VOffset" Type="Extended" >
      <Parameters>
        <Parameter Identifier="Channel" Type="TChannelType"/>
      </Parameters>
      <Getter>
        <Execute Statement="Result:= QueryFloat(ChannelID[Channel] + cVOFFSETQuery)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(ChannelID[Channel] + cVOFFSETCommand + FloatToCode(Value))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.ConvVOffset" Type="ConvInt" >
      <Parameters>
        <Parameter Identifier="Channel" Type="TChannelType"/>
      </Parameters>
      <Getter>
        <Execute Statement="Result:= QueryConvInt(ChannelID[Channel] + cVOFFSETQuery, ucVOffset)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(ChannelID[Channel] + cVOFFSETCommand + ucVOffset.IntValueToEngineeringStr(Value, TUnitPostFix.None, viDecimalSeperatior))"/>
      </Setter>
    </Property>

    <!--0.1,0.2,0.5,1,2,5,10,20,50,100,200,500,1000,2000,5000,10000-->
    <Property Identifier="TSiglentSDS1104X.Attenuation" Type="Extended">
      <Parameters>
        <Parameter Identifier="Channel" Type="TChannelType"/>
      </Parameters>
      <Getter>
        <Execute Statement="Result:= QueryFloat(ChannelID[Channel] + cATTENUATIONQuery)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(ChannelID[Channel] + cATTENUATIONCommand + FloatToCode(Value))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.ConvAttenuation" Type="ConvInt" >
      <Parameters>
        <Parameter Identifier="Channel" Type="TChannelType"/>
      </Parameters>
      <Getter>
        <Execute Statement="Result:= QueryConvInt(ChannelID[Channel] + cATTENUATIONQuery, ucAttenuation)"/>
      </Getter>
      <Setter>
        <Execute Statement="WriteString(ChannelID[Channel] + cATTENUATIONCommand + ucAttenuation.IntValueToEngineeringStr(Value, TUnitPostFix.None, viDecimalSeperatior))"/>
      </Setter>
    </Property>

    <Property Identifier="TSiglentSDS1104X.SampleRate" Type="Extended" >
      <Getter>
        <Execute Statement="Result:= QueryFloat(cSARAQuery)"/>
      </Getter>
    </Property>

    <Procedure Identifier="TSiglentSDS1104X.ScreenCapureToFile">
      <Parameters>
        <Parameter Identifier="Filename" Type="string"/>
        <Parameter Identifier="ImageType" Type="TImageType"/>
      </Parameters>
      <Block>
        <Execute Statement="WriteString(cSCDPCommand)"/>
        <Object.Use Identifier="BlobStream" Type="TMemoryStream" Expression="ReadBlob(cScreenCapureBlobSize)">
          <Case Expression="ImageType">
            <On Select="TImageType.BMP">
              <Execute Statement="BlobStream.SaveToFile(Filename)"/>
            </On>
            <On Select="TImageType.PNG">
              <Object.Use Identifier="BMPObj" Type="TBitmap" Expression="TBitmap.Create">
                <Execute Statement="BMPObj.LoadFromStream(BlobStream)"/>
                <Object.Use Identifier="PNGObj" Type="TPngImage" Expression="TPngImage.Create">
                  <Execute Statement="PNGObj.Assign(BMPObj)"/>
                  <Execute Statement="PNGObj.SaveToFile(Filename)"/>
                </Object.Use>
              </Object.Use>
            </On>
          </Case>
        </Object.Use>
      </Block>
    </Procedure>

    <Procedure Identifier="TSiglentSDS1104X.SaveWaveToFile">
      <Parameters>
        <Parameter Identifier="Filename" Type="string"/>
        <Parameter Identifier="Wave" Type="string"/>
      </Parameters>
      <Block>
        <Execute Statement="WriteString('WVDT? ' + Wave)"/>
        <Object.Use Identifier="BlobStream" Type="TMemoryStream" Expression="ReadBlob(cWaveBlobSize)">
          <Execute Statement="BlobStream.SaveToFile(Filename)"/>
        </Object.Use>
      </Block>
    </Procedure>

    <Function Identifier="TSiglentSDS1104X.WaveForm" Type="TMemoryStream">
      <Parameters>
        <Parameter Identifier="Trace" Type="TTraceType"/>
      </Parameters>
      <Block>
        <!--<Execute Statement="WriteString(TraceID + ':WF? ALL')"/>-->
        <Execute Statement="WriteString(TraceID[Trace] + ':WF? DAT2')"/>
        <!--<Execute Statement="WriteString(TraceID[Trace] + ':WF? ALL')"/>-->
        <Variable Identifier="SaveTimout" Type="UInt32" Init="VisaResource.Timeout"/>
        <Execute Statement="VisaResource.Timeout:= cWaveCaptureTimeout"/>
        <TryFinally>
          <Try>
            <Execute Statement="Result:= ReadBlob(cWaveBlobSize)"/>
          </Try>
          <Finally>
            <Execute Statement="VisaResource.Timeout:= SaveTimout"/>
          </Finally>
        </TryFinally>
      </Block>
    </Function>

    <Procedure Identifier="TSiglentSDS1104X.WaveSetup">
      <Parameters>
        <Parameter Identifier="Segment" Type="Integer"/>
        <Parameter Identifier="LimitSamples" Type="Integer"/>
      </Parameters>
      <Block>
        <Execute Statement="WriteString(cWFSUTYPE1Command)"/>
        <Execute Statement="WriteString(ViFormat(cWFSUCommand, 1, LimitSamples, 0, 0))"/>
      </Block>
    </Procedure>

    <Function Identifier="TSiglentSDS1104X.WaveForm" Type="TMemoryStream">
      <Parameters>
        <Parameter Identifier="Trace" Type="TTraceType"/>
        <Parameter Identifier="Segment" Type="Integer"/>
        <Parameter Identifier="WaveFormat" Type="TWaveFormFormat"/>
      </Parameters>
      <Block>
        <Variable Identifier="TraceIDStr" Type="ViString" Init="TraceID[Trace]"/>
        <Variable Identifier="SegmentStr" Type="ViString" Init="''"/>
        <Block Condition="Segment &gt; 0">
          <Execute Statement="ActiveFrame:= Segment"/>
          <Execute Statement="SegmentStr:= ViFormat(' segment %d', Segment)"/>
        </Block>
        <Case Expression="WaveFormat">
          <On Select="TWaveFormFormat.Dat2">
            <Execute Statement="WriteString(TraceIDStr + ':WF? DAT2')"/>
          </On>
          <On Select="TWaveFormFormat.All">
            <Execute Statement="WriteString(TraceIDStr + ':WF? ALL')"/>
          </On>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorWaveFormFormat)"/>
          </Otherwise>
        </Case>
        <sts:Status.Block Text="Format('Reading waveform %s%s', TraceIDStr, SegmentStr)" LeaveText="Format('Done reading waveform %s%s', TraceIDStr, SegmentStr)">
          <Variable Identifier="SaveTimout" Type="UInt32" Init="VisaResource.Timeout"/>
          <Execute Statement="VisaResource.Timeout:= cWaveCaptureTimeout"/>
          <TryFinally>
            <Try>
              <Execute Statement="Result:= ReadBlob(cWaveBlobSize)"/>
            </Try>
            <Finally>
              <Execute Statement="VisaResource.Timeout:= SaveTimout"/>
            </Finally>
          </TryFinally>
        </sts:Status.Block>
      </Block>
    </Function>

    <Procedure Identifier="TSiglentSDS1104X.WaveCapureToFile">
      <Parameters>
        <Parameter Identifier="Trace" Type="TTraceType"/>
        <Parameter Identifier="Filename" Type="string"/>
      </Parameters>
      <Variables>
        <Variable Identifier="XmlDoc" Type="IXMLDomDocument"/>
        <Variable Identifier="RootE" Type="IXMLDomElement"/>
        <Variable Identifier="DataE" Type="IXMLDomElement"/>
        <Variable Identifier="PointE" Type="IXMLDomElement"/>
        <Variable Identifier="VFactor" Type="Extended"/>
        <Variable Identifier="VOffset" Type="Extended"/>
        <Variable Identifier="Int32Data" Type="Int32"/>
        <Variable Identifier="UInt32Data" Type="UInt32"/>
        <Variable Identifier="AnsiData" Type="AnsiChar"/>
        <Variable Identifier="FloatValue" Type="Extended"/>
        <Variable Identifier="ProbeAttenuation" Type="Extended"/>
        <Variable Identifier="BlockStart" Type="Int32"/>
        <Variable Identifier="BlockSize" Type="UInt32"/>
        <Variable Identifier="BlockSizeCount" Type="Int32"/>
        <Variable Identifier="DescriptionBlockSize" Type="UInt32"/>
        <Variable Identifier="NumberOfPoints" Type="Int32"/>
        <Variable Identifier="PointsPerScreen" Type="Int32"/>
        <Variable Identifier="RawElement" Type="Int32"/>
        <Variable Identifier="TraceS" Type="ViString"/>
        <Variable Identifier="Value" Type="Extended"/>
        <Variable Identifier="Time" Type="Extended"/>
        <Variable Identifier="TimePerSample" Type="Extended"/>
      </Variables>
      <Block>
        <Variable Identifier="TraceIDStr" Type="string" Init="TraceID[Trace]"/>
        <sts:Status.Block Text="Format('Capturing waveform %s to file &quot;%s&quot;', TraceIDStr, Filename)" LeaveText="Format('Done capturing waveform %s to file &quot;%s&quot;', TraceIDStr, Filename)">
          <Variable Identifier="StartTime" Type="Int64" Init="QueryPerformanceCounter" />
          <Object.Use Identifier="Stream" Type="TStream" Expression="WaveForm(Trace, 0, TWaveFormFormat.All)">
            <Variable Identifier="EndTime" Type="Int64" Init="QueryPerformanceCounter" />
            <rep:Reporter.Information Text="Format('Read %d bytes in %f seconds (%f MB/s)', Stream.Size, (EndTime-StartTime)/QueryPerformanceFrequency, Stream.Size / ((EndTime-StartTime)/QueryPerformanceFrequency) / (1024*1024))" Target="Visa" Condition="DoReportVisa"/>
            <msx:Document.Create Identifier="XmlDoc"/>
            <msx:Document.CreateElement Document="XmlDoc" Element="RootE" Name="WaveForm" ParentElement="XmlDoc"/>
            <msx:Element.SetAttribute Element="RootE" Name="xmlns:xsi" Value="'http://www.w3.org/2001/XMLSchema-instance'"/>
            <msx:Element.SetAttribute Element="RootE" Name="xsi:noNamespaceSchemaLocation" Namespace="http://www.w3.org/2001/XMLSchema-instance" Value="'WaveForm.xsd'"/>
            <msx:Document.CreateElement Document="XmlDoc" Element="DataE" Name="Data" ParentElement="RootE"/>
            <rep:Reporter.Information Text="Format('Stream.Size: %d', Stream.Size)" Target="Visa" Condition="DoReportVisa"/>
            <sts:Status.Block Text="Format('Processing %d bytes', Stream.Size)">
              <stm:StateHandler InitialState="SearchDash">
                <ForLoop Indexer="I" From="0" To="Stream.Size - 1">
                  <stm:HandleStates>
                    <stm:State Name="Start">
                      <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingHeader)"/>
                      <Case Expression="CharOrd(AnsiData)" OrdinalType="ansichar" Optimalisation="integermapping">
                        <On Select="'A'..'Z'">
                          <Execute Statement="TraceS:= AnsiData"/>
                          <stm:SetState Name="InTrace" />
                        </On>
                        <Otherwise>
                          <Raise Expression="Exception.Create(sErrorHeaderParsing)"/>
                        </Otherwise>
                      </Case>
                    </stm:State>
                    <stm:State Name="InTrace">
                      <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingHeader)"/>
                      <Case Expression="CharOrd(AnsiData)" OrdinalType="ansichar" Optimalisation="integermapping">
                        <On Select="'A'..'Z', '0'..'9'">
                          <Execute Statement="TraceS:= TraceS + AnsiData"/>
                        </On>
                        <On Select="':'">
                          <!--<rep:Reporter.Information Text="Format('Trace: %s', TraceS)" Target="Visa" Condition="DoReportVisa"/>-->
                          <stm:SetState Name="SearchDash" />
                        </On>
                        <Otherwise>
                          <Raise Expression="Exception.Create(sErrorHeaderParsing)"/>
                        </Otherwise>
                      </Case>
                    </stm:State>
                    <stm:State Name="SearchDash">
                      <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingHeader)"/>
                      <Case Expression="CharOrd(AnsiData)" OrdinalType="ansichar" Optimalisation="integermapping">
                        <On Select="'#'">
                          <stm:SetState Name="SearchNine" />
                        </On>
                      </Case>
                    </stm:State>
                    <stm:State Name="SearchNine">
                      <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingHeader)"/>
                      <Case Expression="CharOrd(AnsiData)" OrdinalType="ansichar" Optimalisation="integermapping">
                        <On Select="'9'">
                          <stm:SetState Name="InSucceedingBlockSize" />
                          <Execute Statement="BlockSizeCount:= 0"/>
                          <Execute Statement="BlockSize:= 0"/>
                        </On>
                      </Case>
                    </stm:State>
                    <stm:State Name="InSucceedingBlockSize">
                      <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingWaveLength)"/>
                      <Execute Statement="BlockSizeCount:= BlockSizeCount + 1"/>
                      <Case Expression="CharOrd(AnsiData)" OrdinalType="ansichar" Optimalisation="integermapping">
                        <On Select="'0'..'9'">
                          <Execute Statement="BlockSize:= BlockSize * 10 + (CharOrd(AnsiData) - ordC0)"/>
                        </On>
                        <Otherwise>
                          <Raise Expression="Exception.Create(sErrorHeaderParsing)"/>
                        </Otherwise>
                      </Case>
                      <Block Condition="BlockSizeCount = 9">
                        <Execute Statement="BlockStart:= Stream.Position"/>

                        <Execute Statement="Stream.Position:= BlockStart + coDescriptionBlockSizeOffset"/>
                        <Raise Condition="Stream.ReadDataUInt16(DescriptionBlockSize) &lt;&gt; 2" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('DescriptionBlockSize: %d', DescriptionBlockSize)" Target="Visa" Condition="DoReportVisa"/>

                        <rep:Reporter.Information Text="Format('BlockStart: %d', BlockStart)" Target="Visa" Condition="DoReportVisa"/>


                        <Execute Statement="Stream.Position:= BlockStart + coNumberOfPointsOffset"/>
                        <Raise Condition="Stream.ReadDataUInt32(NumberOfPoints) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('Nr. of points: %d', NumberOfPoints)" Target="Visa" Condition="DoReportVisa"/>


                        <Execute Statement="Stream.Position:= BlockStart + coWaveSizeOffset"/>
                        <Raise Condition="Stream.ReadDataUInt32(UInt32Data) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('WaveSize: %d', UInt32Data)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coPointsPerScreen"/>
                        <Raise Condition="Stream.ReadDataInt32(PointsPerScreen) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('PointsPerScreen: %d', PointsPerScreen)" Target="Visa" Condition="DoReportVisa"/>
                        <!--<msx:Element.SetAttribute Element="DataE" Name="VUnit" Value="PointsPerScreen"/>-->

                        <Execute Statement="Stream.Position:= BlockStart + coFirstValidPntOffset"/>
                        <Raise Condition="Stream.ReadDataInt32(UInt32Data) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('FirstValidPnt: %d', UInt32Data)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coLastValidPntOffset"/>
                        <Raise Condition="Stream.ReadDataInt32(UInt32Data) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('LastValidPnt: %d', UInt32Data)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coVUnitOffset"/>
                        <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('VUnit: %s', AnsiData)" Target="Visa" Condition="DoReportVisa"/>
                        <msx:Element.SetAttribute Element="DataE" Name="VUnit" Value="AnsiData"/>

                        <Execute Statement="Stream.Position:= BlockStart + coProbeAttenuationOffset"/>
                        <Raise Condition="Stream.ReadDataSingle(ProbeAttenuation) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('ProbeAttenuation: %g', ProbeAttenuation)" Target="Visa" Condition="DoReportVisa"/>
                        <msx:Element.SetAttribute Element="DataE" Name="ProbeAttenuation" Value="FloatToCode(ProbeAttenuation)"/>

                        <Execute Statement="Stream.Position:= BlockStart + coVerticalGainOffset"/>
                        <Raise Condition="Stream.ReadDataSingle(FloatValue) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('VerticalGain: %g', FloatValue)" Target="Visa" Condition="DoReportVisa"/>
                        <Execute Statement="FloatValue:= FloatValue * ProbeAttenuation"/>
                        <msx:Element.SetAttribute Element="DataE" Name="VDiv" Value="FloatToCode(FloatValue)"/>
                        <Execute Statement="VFactor:= FloatValue * cVGran"/>


                        <Execute Statement="Stream.Position:= BlockStart + coVerticalOffsetOffset"/>
                        <Raise Condition="Stream.ReadDataSingle(FloatValue) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('VerticalOffset: %g', FloatValue)" Target="Visa" Condition="DoReportVisa"/>
                        <Execute Statement="FloatValue:= FloatValue * ProbeAttenuation"/>
                        <msx:Element.SetAttribute Element="DataE" Name="VOffset" Value="FloatToCode(FloatValue)"/>
                        <Execute Statement="VOffset:= -FloatValue"/>

                        <Execute Statement="Stream.Position:= BlockStart + coHorizontalIntervalOffset"/>
                        <Raise Condition="Stream.ReadDataSingle(FloatValue) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('HorizontalInterval: %g', FloatValue)" Target="Visa" Condition="DoReportVisa"/>
                        <msx:Element.SetAttribute Element="DataE" Name="HDiv" Value="FloatToCode(FloatValue * PointsPerScreen / cHDivisions)"/>
                        <Execute Statement="TimePerSample:= FloatValue"/>

                        <Execute Statement="Stream.Position:= BlockStart + coHorizontalOffsetOffset"/>
                        <Raise Condition="Stream.ReadDataDouble(FloatValue) &lt;&gt; 8" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('HorizontalOffset: %g', FloatValue)" Target="Visa" Condition="DoReportVisa"/>
                        <msx:Element.SetAttribute Element="DataE" Name="HOffset" Value="FloatToCode(FloatValue)"/>
                        <Execute Statement="Time:= FloatValue - NumberOfPoints * TimePerSample * 0.5"/>

                        <!--<Execute Statement="Stream.Position:= BlockStart + coSegmentIndexOffset"/>
                        <Raise Condition="Stream.ReadDataInt32(Int32Data) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('SegmentIndex: %d', Int32Data)" Target="Visa" Condition="DoReportVisa"/>-->

                        <Execute Statement="Stream.Position:= BlockStart + coNominalBitsOffset"/>
                        <Raise Condition="Stream.ReadDataUInt16(UInt32Data) &lt;&gt; 2" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('NominalBits: %d', UInt32Data)" Target="Visa" Condition="DoReportVisa"/>
                        <msx:Element.SetAttribute Element="DataE" Name="NominalBits" Value="IntToStr(UInt32Data)"/>

                        <Execute Statement="Stream.Position:= BlockStart + coTriggerTimeOffset"/>
                        <Raise Condition="Stream.ReadDataDouble(FloatValue) &lt;&gt; 8" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('TriggerTime: %g', FloatValue)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coPixelOffsetOffset"/>
                        <Raise Condition="Stream.ReadDataDouble(FloatValue) &lt;&gt; 8" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('PixelOffset: %g', FloatValue)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coHorizontalUncertaintyOffset"/>
                        <Raise Condition="Stream.ReadDataSingle(FloatValue) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('HorizontalUncertainty: %g', FloatValue)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + DescriptionBlockSize"/>
                        <stm:SetState Name="WaveData"/>

                        <!--<rep:Reporter.Information Text="Format('BlockSize: %d', BlockSize)" Target="Visa" Condition="DoReportVisa"/>
                        <rep:Reporter.Information Text="Format('Stream.Position: %d', Stream.Position)" Target="Visa" Condition="DoReportVisa"/>
                        <rep:Reporter.Information Text="Format('Stream.Size: %d', Stream.Size)" Target="Visa" Condition="DoReportVisa"/>-->
                      </Block>
                    </stm:State>
                    <stm:State Name="WaveData">
                      <Raise Condition="Stream.ReadDataInt8(RawElement) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingWaveData)"/>
                      <!--<rep:Reporter.Information Text="Format('%d', RawElement)" Target="Visa" Condition="DoReportVisa"/>-->
                      <Execute Statement="Value:= RawElement * VFactor + VOffset"/>
                      <msx:Document.CreateElement Document="XmlDoc" Element="PointE" Name="P" ParentElement="DataE"/>
                      <msx:Element.SetAttribute Element="PointE" Name="X" Value="FloatTocode(Time)"/>
                      <msx:Element.SetAttribute Element="PointE" Name="Y" Value="FloatTocode(Value)"/>
                      <Execute Statement="Time:= Time + TimePerSample"/>
                      <Execute Statement="NumberOfPoints:= NumberOfPoints - 1"/>
                      <stm:SetState Name="Done" Condition="NumberOfPoints = 0"/>
                    </stm:State>
                    <stm:State Name="Done">
                    </stm:State>
                  </stm:HandleStates>
                </ForLoop>
              </stm:StateHandler>
            </sts:Status.Block>
          </Object.Use>
          <Raise Expression="Exception.Create(Format(sErrorInvalidTraceData, BlockSize))" Condition="NumberOfPoints &lt;&gt; 0"/>
          <Variable Identifier="WriteStream" Type="TSequentialFileWriteStream" Init="TSequentialFileWriteStream.Create(Filename)"/>
          <Variable Identifier="Stream" Type="IStream" Init="WriteStream as IStream"/>
          <Variable Identifier="MXWriter" Type="IMXWriter" Init="CoMXXMLWriter60.Create"/>
          <Execute Statement="MXWriter.Output:= Stream"/>
          <Execute Statement="MXWriter.Indent:= True"/>
          <Execute Statement="MXWriter.encoding:= 'utf-8'"/>
          <Variable Identifier="Output" Type="Variant" Init="MXWriter"/>
          <Variable Identifier="XMLReader" Type="ISAXXMLReader" Init="CoSAXXMLReader60.Create"/>
          <Execute Statement="XMLReader.putContentHandler(MXWriter as ISAXContentHandler)"/>
          <Execute Statement="XMLReader.Parse(XmlDoc)"/>
        </sts:Status.Block>
      </Block>
    </Procedure>

    <Procedure Identifier="LoadSamplesFromStream">
      <Parameters>
        <Parameter Identifier="AcquisitionInfo" Type="TAcquisitionInfo"/>
        <Parameter Identifier="Stream" Type="TStream"/>
        <Parameter Identifier="LimitSamples" Type="Int32"/>
      </Parameters>
      <Type>
        <Enumeration Identifier="TProcessKind" Elements="MultiFrameInitial, MutiFrameUpdate, SingleSum"/>
      </Type>
      <Variables>
        <Variable Identifier="ProcessKind" Type="TProcessKind"/>
        <Variable Identifier="WaveForm" Type="TWaveFormFormat"/>
        <Variable Identifier="FloatValue" Type="Extended"/>
        <Variable Identifier="TimePerSample" Type="Extended"/>
        <Variable Identifier="ProbeAttenuation" Type="Extended"/>
        <Variable Identifier="BlockStart" Type="Int32"/>
        <Variable Identifier="NumberOfPoints" Type="Int32"/>
        <Variable Identifier="DescriptionBlockSize" Type="UInt32"/>
        <Variable Identifier="BlockSize" Type="UInt32"/>
        <Variable Identifier="BlockSizeCount" Type="Int32"/>
        <Variable Identifier="Int32Data" Type="Int32"/>
        <Variable Identifier="UInt32Data" Type="UInt32"/>
        <Variable Identifier="AnsiData" Type="AnsiChar"/>
        <Variable Identifier="FormatS" Type="ViString"/>
        <Variable Identifier="RawElement" Type="Int32"/>
        <Variable Identifier="ActiveDataPoint" Type="TSamplePoint"/>
        <Variable Identifier="SamplePointManager" Type="TSamplePointManager"/>
        <Variable Identifier="SingleSample" Type="TSamplePoint32"/>
        <Variable Identifier="PointsPerScreen" Type="Int32"/>
      </Variables>
      <Block>
        <Choose>
          <When Expression="AcquisitionInfo is TMultiFrameAcquisitionInfo">
            <Execute Statement="SamplePointManager:= TMultiFrameAcquisitionInfo(AcquisitionInfo).SamplePointManager"/>
            <Choose>
              <When Expression="TMultiFrameAcquisitionInfo(AcquisitionInfo).Initial">
                <Execute Statement="ProcessKind:= TProcessKind.MultiFrameInitial"/>
              </When>
              <Otherwise>
                <Execute Statement="ProcessKind:= TProcessKind.MutiFrameUpdate"/>
                <Execute Statement="ActiveDataPoint:= SamplePointManager.SampleHead"/>
              </Otherwise>
            </Choose>
          </When>
          <When Expression="AcquisitionInfo is TSingleSummedSampleAcquisitionInfo">
            <Execute Statement="ProcessKind:= TProcessKind.SingleSum"/>
            <Execute Statement="SingleSample:= TSingleSummedSampleAcquisitionInfo(AcquisitionInfo).Sample"/>
          </When>
          <Otherwise>
            <Raise Expression="Exception.Create(sErrorUnsupportedAcquisitionType)"/>
          </Otherwise>
        </Choose>
        <Execute Statement="Stream.Position:= 0"/>
        <stm:StateHandler InitialState="Start">
          <WhileLoop Expression="Stream.Position &lt; Stream.Size">
            <ExitOnAbortRequest/>
            <stm:HandleStates>
              <stm:State Name="Start">
                <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingHeader)"/>
                <Case Expression="CharOrd(AnsiData)" OrdinalType="ansichar" Optimalisation="integermapping">
                  <On Select="'A'..'Z'">
                    <Execute Statement="FormatS:= AnsiData"/>
                    <stm:SetState Name="InTrace" />
                  </On>
                  <Otherwise>
                    <Raise Expression="Exception.Create(sErrorHeaderParsing)"/>
                  </Otherwise>
                </Case>
              </stm:State>
              <stm:State Name="InTrace">
                <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingHeader)"/>
                <Case Expression="CharOrd(AnsiData)" OrdinalType="ansichar" Optimalisation="integermapping">
                  <On Select="'A'..'Z', '0'..'9'">
                    <Execute Statement="FormatS:= FormatS + AnsiData"/>
                  </On>
                  <On Select="','">
                    <rep:Reporter.Information Text="Format('WaveFormat: %s', FormatS)" Target="Visa" Condition="DoReportVisa"/>
                    <Choose>
                      <When Expression="FormatS = 'DAT2'">
                        <Execute Statement="WaveForm:= TWaveFormFormat.Dat2"/>
                      </When>
                      <When Expression="FormatS = 'ALL'">
                        <Execute Statement="WaveForm:= TWaveFormFormat.All"/>
                      </When>
                      <Otherwise>
                        <Raise Expression="Exception.Create(sErrorHeaderParsing)"/>
                      </Otherwise>
                    </Choose>
                    <stm:SetState Name="SearchDash" />
                  </On>
                  <Otherwise>
                    <Raise Expression="Exception.Create(sErrorHeaderParsing)"/>
                  </Otherwise>
                </Case>
              </stm:State>
              <stm:State Name="SearchDash">
                <!--<rep:Reporter.Information Text="'SearchDash'" Target="Visa" Condition="DoReportVisa"/>-->
                <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingHeader)"/>
                <Case Expression="CharOrd(AnsiData)" OrdinalType="ansichar" Optimalisation="integermapping">
                  <On Select="'#'">
                    <stm:SetState Name="SearchNine" />
                  </On>
                </Case>
              </stm:State>
              <stm:State Name="SearchNine">
                <!--<rep:Reporter.Information Text="'SearchNine'" Target="Visa" Condition="DoReportVisa"/>-->
                <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingHeader)"/>
                <Case Expression="CharOrd(AnsiData)" OrdinalType="ansichar" Optimalisation="integermapping">
                  <On Select="'9'">
                    <stm:SetState Name="InSucceedingBlockSize" />
                    <Execute Statement="BlockSizeCount:= 0"/>
                    <Execute Statement="BlockSize:= 0"/>
                  </On>
                </Case>
              </stm:State>
              <stm:State Name="InSucceedingBlockSize">
                <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingWaveLength)"/>
                <Execute Statement="BlockSizeCount:= BlockSizeCount + 1"/>
                <Case Expression="CharOrd(AnsiData)" OrdinalType="ansichar" Optimalisation="integermapping">
                  <On Select="'0'..'9'">
                    <Execute Statement="BlockSize:= BlockSize * 10 + (CharOrd(AnsiData) - ordC0)"/>
                  </On>
                  <Otherwise>
                    <Raise Expression="Exception.Create(sErrorHeaderParsing)"/>
                  </Otherwise>
                </Case>
                <Block Condition="BlockSizeCount = 9">
                  <Execute Statement="BlockStart:= Stream.Position"/>
                  <Case Expression="WaveForm">
                    <On Select="TWaveFormFormat.Dat2">
                      <Execute Statement="NumberOfPoints:= BlockSize"/>
                      <Raise Expression="Exception.Create(sInvalidInitialWaveformat)" Condition="ProcessKind &lt;&gt; TProcessKind.MutiFrameUpdate"/>
                    </On>
                    <On Select="TWaveFormFormat.All">
                      <Execute Statement="Stream.Position:= BlockStart + coDescriptionBlockSizeOffset"/>
                      <Raise Condition="Stream.ReadDataUInt16(DescriptionBlockSize) &lt;&gt; 2" Expression="Exception.Create(sErrorReadingWaveData)"/>
                      <rep:Reporter.Information Text="Format('DescriptionBlockSize: %d', DescriptionBlockSize)" Target="Visa" Condition="DoReportVisa"/>
                      <Block Condition="ProcessKind &lt;&gt; TProcessKind.MutiFrameUpdate">
                        <rep:Reporter.Information Text="Format('BlockStart: %d', BlockStart)" Target="Visa" Condition="DoReportVisa"/>


                        <Execute Statement="Stream.Position:= BlockStart + coNumberOfPointsOffset"/>
                        <Raise Condition="Stream.ReadDataUInt32(NumberOfPoints) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('Nr. of points: %d', NumberOfPoints)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coWaveSizeOffset"/>
                        <Raise Condition="Stream.ReadDataUInt32(UInt32Data) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('WaveSize: %d', UInt32Data)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coPointsPerScreen"/>
                        <Raise Condition="Stream.ReadDataInt32(PointsPerScreen) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('PointsPerScreen: %d', PointsPerScreen)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coFirstValidPntOffset"/>
                        <Raise Condition="Stream.ReadDataInt32(UInt32Data) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('FirstValidPnt: %d', UInt32Data)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coLastValidPntOffset"/>
                        <Raise Condition="Stream.ReadDataInt32(UInt32Data) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('LastValidPnt: %d', UInt32Data)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coVUnitOffset"/>
                        <Raise Condition="Stream.ReadDataAnsiChar(AnsiData) &lt;&gt; 1" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <Execute Statement="AcquisitionInfo.VUnit:= AnsiData"/>
                        <rep:Reporter.Information Text="Format('VUnit: %s', AnsiData)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coProbeAttenuationOffset"/>
                        <Raise Condition="Stream.ReadDataSingle(ProbeAttenuation) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <Execute Statement="AcquisitionInfo.ProbeAttenuation:= ProbeAttenuation"/>
                        <rep:Reporter.Information Text="Format('ProbeAttenuation: %g', ProbeAttenuation)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coVerticalGainOffset"/>
                        <Raise Condition="Stream.ReadDataSingle(FloatValue) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('VerticalGain: %g', FloatValue)" Target="Visa" Condition="DoReportVisa"/>
                        <Execute Statement="FloatValue:= FloatValue * ProbeAttenuation"/>
                        <Execute Statement="AcquisitionInfo.VDiv:= FloatValue"/>
                        <Execute Statement="AcquisitionInfo.VFactor:= FloatValue * cVGran"/>

                        <Execute Statement="Stream.Position:= BlockStart + coVerticalOffsetOffset"/>
                        <Raise Condition="Stream.ReadDataSingle(FloatValue) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('VerticalOffset: %g', FloatValue)" Target="Visa" Condition="DoReportVisa"/>
                        <Execute Statement="AcquisitionInfo.VOffset:= -FloatValue * ProbeAttenuation"/>

                        <Execute Statement="Stream.Position:= BlockStart + coHorizontalIntervalOffset"/>
                        <Raise Condition="Stream.ReadDataSingle(TimePerSample) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('HorizontalInterval: %g', TimePerSample)" Target="Visa" Condition="DoReportVisa"/>
                        <Execute Statement="AcquisitionInfo.HDiv:= TimePerSample * PointsPerScreen / cHDivisions"/>
                        <Execute Statement="AcquisitionInfo.TimePerSample:= TimePerSample"/>

                        <Execute Statement="Stream.Position:= BlockStart + coHorizontalOffsetOffset"/>
                        <Raise Condition="Stream.ReadDataDouble(FloatValue) &lt;&gt; 8" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('HorizontalOffset: %g', FloatValue)" Target="Visa" Condition="DoReportVisa"/>
                        <Execute Statement="AcquisitionInfo.Time:= FloatValue - NumberOfPoints * TimePerSample * 0.5"/>
                        <Execute Statement="AcquisitionInfo.HOffset:= FloatValue"/>

                        <Execute Statement="Stream.Position:= BlockStart + coSegmentIndexOffset"/>
                        <Raise Condition="Stream.ReadDataInt32(Int32Data) &lt;&gt; 4" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('SegmentIndex: %d', Int32Data)" Target="Visa" Condition="DoReportVisa"/>

                        <Execute Statement="Stream.Position:= BlockStart + coNominalBitsOffset"/>
                        <Raise Condition="Stream.ReadDataUInt16(UInt32Data) &lt;&gt; 2" Expression="Exception.Create(sErrorReadingWaveData)"/>
                        <rep:Reporter.Information Text="Format('NominalBits: %d', UInt32Data)" Target="Visa" Condition="DoReportVisa"/>
                      </Block>
                      <Execute Statement="Stream.Position:= BlockStart + DescriptionBlockSize"/>
                    </On>
                    <Otherwise>
                      <Raise Expression="Exception.Create(sErrorWaveFormFormat)"/>
                    </Otherwise>
                  </Case>
                  <Case Expression="ProcessKind" Optimalisation="integermapping">
                    <On Select="TProcessKind.MultiFrameInitial">
                      <Execute Statement="NumberOfPoints:= LimitSamples" Condition="(LimitSamples &gt; 0) and (LimitSamples &lt; NumberOfPoints)"/>
                      <rep:Reporter.Information Text="Format('NumberOfPoints: %d', NumberOfPoints)" Target="Visa" Condition="DoReportVisa"/>
                      <Execute Statement="TMultiFrameAcquisitionInfo(AcquisitionInfo).Initial:= False"/>
                      <stm:SetState Name="WaveDataCreateDataPoints"/>
                    </On>
                    <On Select="TProcessKind.MutiFrameUpdate">
                      <stm:SetState Name="WaveDataUpdateDataPoints"/>
                    </On>
                    <On Select="TProcessKind.SingleSum">
                      <Execute Statement="NumberOfPoints:= LimitSamples" Condition="(LimitSamples &gt; 0) and (LimitSamples &lt; NumberOfPoints)"/>
                      <rep:Reporter.Information Text="Format('NumberOfPoints: %d', NumberOfPoints)" Target="Visa" Condition="DoReportVisa"/>
                      <stm:SetState Name="WaveDataUpdateSingleSample"/>
                    </On>
                  </Case>
                  <!-- Wrong in all dataformat!-->
                  <!--<rep:Reporter.Information Text="Format('BlockSize: %d', BlockSize)" Target="Visa" Condition="DoReportVisa"/>
                  <rep:Reporter.Information Text="Format('Stream.Position: %d', Stream.Position)" Target="Visa" Condition="DoReportVisa"/>
                  <rep:Reporter.Information Text="Format('Stream.Size: %d', Stream.Size)" Target="Visa" Condition="DoReportVisa"/>-->
                </Block>
              </stm:State>
              <stm:State Name="WaveDataCreateDataPoints">
                <Raise Condition="Stream.ReadDataInt8(RawElement) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingWaveData)"/>
                <Execute Statement="ActiveDataPoint:= SamplePointManager.NewPoint"/>
                <Execute Statement="ActiveDataPoint.Add(RawElement)"/>
                <Execute Statement="NumberOfPoints:= NumberOfPoints - 1"/>
                <stm:SetState Name="Done" Condition="NumberOfPoints = 0"/>
              </stm:State>
              <stm:State Name="WaveDataUpdateDataPoints">
                <Raise Condition="Stream.ReadDataInt8(RawElement) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingWaveData)"/>
                <Execute Statement="ActiveDataPoint.Add(RawElement)"/>
                <Execute Statement="ActiveDataPoint:= ActiveDataPoint.Next"/>
                <stm:SetState Name="Done" Condition="not Assigned(ActiveDataPoint)"/>
              </stm:State>
              <stm:State Name="WaveDataUpdateSingleSample">
                <Raise Condition="Stream.ReadDataInt8(RawElement) &lt;&gt; 1 " Expression="Exception.Create(sErrorReadingWaveData)"/>
                <Execute Statement="SingleSample.Add(RawElement)"/>
                <Execute Statement="NumberOfPoints:= NumberOfPoints - 1"/>
                <stm:SetState Name="Done" Condition="NumberOfPoints = 0"/>
              </stm:State>
              <stm:State Name="Done">
                <Execute Statement="Stream.Position:= Stream.Size"/>
              </stm:State>
            </stm:HandleStates>
          </WhileLoop>
        </stm:StateHandler>
      </Block>
    </Procedure>

    <Function Identifier="TSiglentSDS1104X.GetMultiFrameSamples" Type="TMultiFrameAcquisitionInfo">
      <Parameters>
        <Parameter Identifier="Trace" Type="TTraceType"/>
        <Parameter Identifier="FrameHighIndex" Type="Int64"/>
        <Parameter Identifier="Options" Type="TMultiFrameAcquisitionOptions"/>
      </Parameters>
      <Variables>
        <Variable Identifier="LimitSamples" Type="Int32" Init="0"/>
        <Variable Identifier="WaveFormFormat" Type="TWaveFormFormat" Init="TWaveFormFormat.All"/>
      </Variables>
      <Block>
        <Variable Identifier="TraceIDStr" Type="string" Init="TraceID[Trace]"/>
        <sts:Status.Block Text="Format('Capturing %s in %d segments', TraceIDStr, FrameHighIndex)" LeaveText="Format('Done capturing %s in %d segments', TraceIDStr, FrameHighIndex)">
          <Execute Statement="Result:= TMultiFrameAcquisitionInfo.Create"/>
          <Block Condition="Assigned(Options)">
            <Execute Statement="LimitSamples:= Options.LimitSamples"/>
          </Block>
          <Execute Statement="Result.Count:= FrameHighIndex"/>
          <Execute Statement="WaveSetup(0, LimitSamples)"/>
          <Object.Use Identifier="Stream" Type="TSafeArrayStream" Expression="TSafeArrayStream.Create">
            <ForLoop Indexer="ActiveFrameIndex" From="1" To="FrameHighIndex">
              <Variable Identifier="StartTime" Type="Int64" Init="QueryPerformanceCounter" />
              <ExitOnAbortRequest/>
              <Object.Use Identifier="Stream" Type="TStream" Expression="WaveForm(Trace, ActiveFrameIndex, WaveFormFormat)">
                <Variable Identifier="EndTime" Type="Int64" Init="QueryPerformanceCounter" />
                <rep:Reporter.Information Text="Format('Read %d bytes in %f seconds (%f MB/s)', Stream.Size, (EndTime-StartTime)/QueryPerformanceFrequency, Stream.Size / ((EndTime-StartTime)/QueryPerformanceFrequency) / (1024*1024))" Target="Visa" Condition="DoReportVisa"/>
                <sts:Status.Block Text="Format('Processing %d bytes of segment %d', Stream.Size, ActiveFrameIndex)" LeaveText="Format('Done processing data of segment %d', ActiveFrameIndex)">
                  <Execute Statement="LoadSamplesFromStream(Result, Stream, LimitSamples)"/>
                </sts:Status.Block>
                <!--<Execute Statement="Stream.SaveToFile(Format('C:\Users\MW\SynologyDrive\Transfer\WavePointLimitTest01\Wave\Wave %.3d.dat', ActiveFrameIndex))" Condition="IsDebugging"/>-->
              </Object.Use>
              <Execute Statement="WaveFormFormat:= TWaveFormFormat.Dat2"/>
            </ForLoop>
          </Object.Use>
        </sts:Status.Block>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104X.GetSingleSummedSample" Type="TSingleSummedSampleAcquisitionInfo">
      <Parameters>
        <Parameter Identifier="Trace" Type="TTraceType"/>
        <Parameter Identifier="Options" Type="TSingleSummedSampleAcquisitionOptions"/>
      </Parameters>
      <Variables>
        <Variable Identifier="LimitSamples" Type="Int32" Init="0"/>
      </Variables>
      <Block>
        <Execute Statement="Result:= TSingleSummedSampleAcquisitionInfo.Create"/>
        <Block Condition="Assigned(Options)">
          <Execute Statement="LimitSamples:= Options.LimitSamples"/>
        </Block>
        <Execute Statement="WaveSetup(0, LimitSamples)"/>
        <Variable Identifier="StartTime" Type="Int64" Init="QueryPerformanceCounter" />
        <Object.Use Identifier="Stream" Type="TMemoryStream" Expression="WaveForm(Trace, 0, TWaveFormFormat.All)">
          <ExitOnAbortRequest/>
          <Variable Identifier="EndTime" Type="Int64" Init="QueryPerformanceCounter" />
          <rep:Reporter.Information Text="Format('Read %d bytes in %f seconds (%f MB/s)', Stream.Size, (EndTime-StartTime)/QueryPerformanceFrequency, Stream.Size / ((EndTime-StartTime)/QueryPerformanceFrequency) / (1024*1024))" Target="Visa" Condition="DoReportVisa"/>
          <sts:Status.Block Text="Format('Processing %d bytes', Stream.Size)" LeaveText="'Done processing data'">
            <Execute Statement="LoadSamplesFromStream(Result, Stream, LimitSamples)"/>
          </sts:Status.Block>
        </Object.Use>
      </Block>
    </Function>

    <Procedure Identifier="TSiglentSDS1104X.Stop">
      <Block>
        <Execute Statement="WriteString(cSTOPCommand)"/>
      </Block>
    </Procedure>

    <Procedure Identifier="TSiglentSDS1104X.Wait">
      <Block>
        <Execute Statement="WriteString(cWAITCommand)"/>
      </Block>
    </Procedure>

    <Procedure Identifier="TSiglentSDS1104X.Wait">
      <Parameters>
        <Parameter Identifier="Time" Type="Extended"/>
      </Parameters>
      <Block>
        <Execute Statement="WriteString(cWAITCommandSpace + FloatToCode(Time))"/>
      </Block>
    </Procedure>

    <Procedure Identifier="TSiglentSDS1104X.Arm">
      <Block>
        <Execute Statement="WriteString('ARM')"/>
      </Block>
    </Procedure>

    <Procedure Identifier="TSiglentSDS1104X.CheckStatus">
      <Block>
        <Execute Statement="WriteString(cINRQuery)"/>
        <Variable Identifier="StatusFlags" Type="UInt32" Init="ReadUInt32"/>
        <Execute Statement="_SignalAcquiredStatusCnt:= _SignalAcquiredStatusCnt + 1" Condition="(StatusFlags and TStatusFlags.SignalAcquired) = TStatusFlags.SignalAcquired"/>
        <Execute Statement="_TriggerIsReadyStatusCnt:= _TriggerIsReadyStatusCnt + 1" Condition="(StatusFlags and TStatusFlags.TriggerIsReady) = TStatusFlags.TriggerIsReady"/>
      </Block>
    </Procedure>

    <Procedure Identifier="TSiglentSDS1104X.CheckStatus">
      <Parameters>
        <Parameter Identifier="SignalAcquiredStatusCnt" Type="UInt64" Direction="Output"/>
        <Parameter Identifier="TriggerIsReadyStatusCnt" Type="UInt64" Direction="Output"/>
      </Parameters>
      <Block>
        <Execute Statement="WriteString(cINRQuery)"/>
        <Variable Identifier="StatusFlags" Type="UInt32" Init="ReadUInt32"/>
        <Execute Statement="_SignalAcquiredStatusCnt:= _SignalAcquiredStatusCnt + 1" Condition="(StatusFlags and TStatusFlags.SignalAcquired) = TStatusFlags.SignalAcquired"/>
        <Execute Statement="_TriggerIsReadyStatusCnt:= _TriggerIsReadyStatusCnt + 1" Condition="(StatusFlags and TStatusFlags.TriggerIsReady) = TStatusFlags.TriggerIsReady"/>
        <Execute Statement="SignalAcquiredStatusCnt:= _SignalAcquiredStatusCnt"/>
        <Execute Statement="TriggerIsReadyStatusCnt:= _TriggerIsReadyStatusCnt"/>
      </Block>
    </Procedure>

    <Procedure Identifier="TSiglentSDS1104X.SetAverageMode">
      <Parameters>
        <Parameter Identifier="Time" Type="TAvgTime"/>
      </Parameters>
      <Block>
        <Execute Statement="WriteString(cACQUIRE_WAYCommand + AvgTime[Time])"/>
      </Block>
    </Procedure>

    <Function Identifier="TSiglentSDS1104XIniHelper.ConvReadTDiv" Type="ConvInt">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="string"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= ReadConvInt(Key, ucTDiv, Default)"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ConvReadMathVDiv" Type="ConvInt">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="string"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= ReadConvInt(Key, ucMathVDiv, Default)"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ConvReadMathVPosition" Type="ConvInt">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="string"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= ReadConvInt(Key, ucMathVPosition, Default)"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ConvReadTriggerDelay" Type="ConvInt">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="string"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= ReadConvInt(Key, ucTriggerDelay, Default)"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ConvReadTriggerLevel" Type="ConvInt">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="string"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= ReadConvInt(Key, ucTriggerLevel, Default)"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ConvReadVDiv" Type="ConvInt">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="string"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= ReadConvInt(Key, ucVDiv, Default)"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ConvReadVOffset" Type="ConvInt">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="string"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= ReadConvInt(Key, ucVOffset, Default)"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ConvReadAttenuation" Type="ConvInt">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="string"/>
      </Parameters>
      <Block>
        <Execute Statement="Result:= ReadConvInt(Key, ucAttenuation, Default)"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ReadTraceType" Type="TTraceType">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="TTraceType"/>
      </Parameters>
      <Block>
        <Variable Identifier="DefaultString" Type="string" Init="TSiglentSDS1104X.TraceTypeName(Default)"/>
        <Variable Identifier="ResultS" Type="string" Init="Inifile.ReadString(CurrentSection, Key, DefaultString)"/>
        <Execute Statement="Result:= TSiglentSDS1104X.TraceTypeFromName(ResultS)"/>
        <rep:Reporter.Information Text="Format('%s=%s', Key, TSiglentSDS1104X.TraceTypeName(Result))" Condition="EnableEcho"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ReadHWTraceType" Type="THWTraceType">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="THWTraceType"/>
      </Parameters>
      <Block>
        <Variable Identifier="DefaultString" Type="string" Init="TSiglentSDS1104X.HWTraceTypeName(Default)"/>
        <Variable Identifier="ResultS" Type="string" Init="Inifile.ReadString(CurrentSection, Key, DefaultString)"/>
        <Execute Statement="Result:= TSiglentSDS1104X.HWTraceTypeFromName(ResultS)"/>
        <rep:Reporter.Information Text="Format('%s=%s', Key, TSiglentSDS1104X.HWTraceTypeName(Result))" Condition="EnableEcho"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ReadChannelType" Type="TChannelType">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="TChannelType"/>
      </Parameters>
      <Block>
        <Variable Identifier="DefaultString" Type="string" Init="TSiglentSDS1104X.ChannelTypeName(Default)"/>
        <Variable Identifier="ResultS" Type="string" Init="Inifile.ReadString(CurrentSection, Key, DefaultString)"/>
        <Execute Statement="Result:= TSiglentSDS1104X.ChannelTypeFromName(ResultS)"/>
        <rep:Reporter.Information Text="Format('%s=%s', Key, TSiglentSDS1104X.ChannelTypeName(Result))" Condition="EnableEcho"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ReadTriggerMode" Type="TTriggerMode">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="TTriggerMode"/>
      </Parameters>
      <Block>
        <Variable Identifier="DefaultString" Type="string" Init="TSiglentSDS1104X.TriggerModeName(Default)"/>
        <Variable Identifier="ResultS" Type="string" Init="Inifile.ReadString(CurrentSection, Key, DefaultString)"/>
        <Execute Statement="Result:= TSiglentSDS1104X.TriggerModeFromName(ResultS)"/>
        <rep:Reporter.Information Text="Format('%s=%s', Key, TSiglentSDS1104X.TriggerModeName(Result))" Condition="EnableEcho"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ReadMemSize" Type="TMemSize">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="TMemSize"/>
      </Parameters>
      <Block>
        <Variable Identifier="DefaultString" Type="string" Init="TSiglentSDS1104X.MemSizeName(Default)"/>
        <Variable Identifier="ResultS" Type="string" Init="Inifile.ReadString(CurrentSection, Key, DefaultString)"/>
        <Execute Statement="Result:= TSiglentSDS1104X.MemSizeFromName(ResultS)"/>
        <rep:Reporter.Information Text="Format('%s=%s', Key, TSiglentSDS1104X.MemSizeName(Result))" Condition="EnableEcho"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ReadAvgTime" Type="TAvgTime">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="TAvgTime"/>
      </Parameters>
      <Block>
        <Variable Identifier="DefaultString" Type="string" Init="TSiglentSDS1104X.AvgTimeName(Default)"/>
        <Variable Identifier="ResultS" Type="string" Init="Inifile.ReadString(CurrentSection, Key, DefaultString)"/>
        <Execute Statement="Result:= TSiglentSDS1104X.AvgTimeFromName(ResultS)"/>
        <rep:Reporter.Information Text="Format('%s=%s', Key, TSiglentSDS1104X.AvgTimeName(Result))" Condition="EnableEcho"/>
      </Block>
    </Function>

    <Function Identifier="TSiglentSDS1104XIniHelper.ReadAcquireWay" Type="TAcquireWay">
      <Parameters>
        <Parameter Identifier="Key" Type="string"/>
        <Parameter Identifier="Default" Type="TAcquireWay"/>
      </Parameters>
      <Block>
        <Variable Identifier="DefaultString" Type="string" Init="TSiglentSDS1104X.AcquireWayName(Default)"/>
        <Variable Identifier="ResultS" Type="string" Init="Inifile.ReadString(CurrentSection, Key, DefaultString)"/>
        <Execute Statement="Result:= TSiglentSDS1104X.AcquireWayFromName(ResultS)"/>
        <rep:Reporter.Information Text="Format('%s=%s', Key, TSiglentSDS1104X.AcquireWayName(Result))" Condition="EnableEcho"/>
      </Block>
    </Function>

    <Constructor Identifier="TSiglentSDS1104XIniHelper.Create">
      <Parameters>
        <Parameter Identifier="Inifile" Type="TCustomIniFile"/>
        <Parameter Identifier="EnableEcho" Type="Boolean"/>
      </Parameters>
      <Block>
        <Execute Statement="inherited Create(Inifile, EnableEcho)"/>
      </Block>
    </Constructor>

  </Procedures>

  <Finalization>
    <Free Identifier="TraceTypeNameIndex"/>
    <Free Identifier="HWTraceTypeNameIndex"/>
    <Free Identifier="ChannelTypeNameIndex"/>
    <Free Identifier="TriggerModeNameIndex"/>
    <Free Identifier="MemSizeNameIndex"/>
    <Free Identifier="AvgTimeNameIndex"/>
    <Free Identifier="AcquireWayNameIndex"/>
  </Finalization>

</pkg:Library>